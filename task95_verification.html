<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡95ç¿»è½¬ä¿®å¤éªŒè¯</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f7fb;
            padding: 20px;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .status-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .task-demo {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        .control-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .flip-container {
            width: 282.66px;
            height: 307.46px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            perspective: 1500px;
            margin: 0 auto;
            cursor: pointer;
        }
        .flip-container.flipped {
            transform: rotateY(180deg);
        }
        .task-front, .task-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            box-sizing: border-box;
        }
        .task-front {
            background: white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            z-index: 2;
        }
        .task-back {
            background: white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            transform: rotateY(180deg);
            z-index: 1;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background-color: #4cc9f0; }
        .status-error { background-color: #ef233c; }
        .status-warning { background-color: #f72585; }
        .status-loading { background-color: #7209b7; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">
            <i class="fas fa-cube me-2"></i>ä»»åŠ¡95ç¿»è½¬ä¿®å¤éªŒè¯
        </h1>
        
        <!-- çŠ¶æ€é¢æ¿ -->
        <div class="status-panel">
            <h4><i class="fas fa-info-circle me-2"></i>ä¿®å¤çŠ¶æ€</h4>
            <div class="row">
                <div class="col-md-3">
                    <div class="d-flex align-items-center mb-2">
                        <span class="status-indicator status-loading" id="fixStatus"></span>
                        <span>ä¿®å¤è„šæœ¬åŠ è½½</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center mb-2">
                        <span class="status-indicator status-loading" id="backContentStatus"></span>
                        <span>èƒŒé¢å†…å®¹åˆ›å»º</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center mb-2">
                        <span class="status-indicator status-loading" id="flipFunctionStatus"></span>
                        <span>ç¿»è½¬åŠŸèƒ½</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="d-flex align-items-center mb-2">
                        <span class="status-indicator status-loading" id="overallStatus"></span>
                        <span>æ•´ä½“çŠ¶æ€</span>
                    </div>
                </div>
            </div>
            <div class="mt-3" id="statusDetails">
                <small class="text-muted">æ­£åœ¨æ£€æµ‹ä¿®å¤çŠ¶æ€...</small>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <h4><i class="fas fa-sliders-h me-2"></i>æµ‹è¯•æ§åˆ¶</h4>
            <div class="row g-3">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" onclick="executeFix()">
                        <i class="fas fa-wrench me-2"></i>æ‰§è¡Œä¿®å¤
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100" onclick="testFlip()">
                        <i class="fas fa-sync-alt me-2"></i>æµ‹è¯•ç¿»è½¬
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info w-100" onclick="checkStatus()">
                        <i class="fas fa-search me-2"></i>æ£€æŸ¥çŠ¶æ€
                    </button>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <button class="btn btn-outline-secondary w-100" onclick="resetTest()">
                        <i class="fas fa-redo me-2"></i>é‡ç½®æµ‹è¯•
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ä»»åŠ¡æ¼”ç¤ºåŒºåŸŸ -->
        <div class="task-demo">
            <h4><i class="fas fa-cube me-2"></i>ä»»åŠ¡95æ¼”ç¤º</h4>
            <p class="text-muted">ç‚¹å‡»ä¸‹æ–¹å¡ç‰‡æˆ–ä½¿ç”¨æ§åˆ¶é¢æ¿æµ‹è¯•ç¿»è½¬åŠŸèƒ½</p>
            
            <div class="flip-container" id="task95Demo" onclick="manualFlip()">
                <!-- æ­£é¢ -->
                <div class="task-front" id="task95DemoFront">
                    <div style="text-align: center; width: 100%;">
                        <div class="task-gallery-img" style="width: 262.66px; height: 259.06px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; background-color: rgb(248, 249, 250); display: flex; align-items: center; justify-content: center; min-height: 259.06px; max-height: 259.06px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-image fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">åŒ–å¦†åŒ…</div>
                                <div class="task-gallery-code" data-content="KABI-165" style="font-size: 0.75rem; color: #666; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">è´§å·: KABI-165</div>
                                <div class="task-gallery-qty" data-content="1" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 1</div>
                                <div class="task-gallery-creator" data-content="ç®¡ç†å‘˜" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary mt-3" onclick="event.stopPropagation(); manualFlip()">
                            <i class="fas fa-file-alt me-1"></i>æŸ¥çœ‹æ–‡ä»¶
                        </button>
                    </div>
                </div>
                
                <!-- èƒŒé¢ï¼ˆå°†ç”±è„šæœ¬åŠ¨æ€åˆ›å»ºï¼‰ -->
            </div>
        </div>
        
        <!-- è¯Šæ–­ä¿¡æ¯ -->
        <div class="status-panel">
            <h4><i class="fas fa-diagnoses me-2"></i>è¯Šæ–­ä¿¡æ¯</h4>
            <div id="diagnosisInfo">
                <p class="text-muted">ç­‰å¾…æ‰§è¡Œè¯Šæ–­...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="task95_back_content_fix.js"></script>
    
    <script>
        let flipCount = 0;
        let testStatus = {
            fixLoaded: false,
            backContentCreated: false,
            flipFunctionWorking: false
        };
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const fixIndicator = document.getElementById('fixStatus');
            const backIndicator = document.getElementById('backContentStatus');
            const flipIndicator = document.getElementById('flipFunctionStatus');
            const overallIndicator = document.getElementById('overallStatus');
            const statusDetails = document.getElementById('statusDetails');
            
            // æ›´æ–°å„ä¸ªçŠ¶æ€æŒ‡ç¤ºå™¨
            fixIndicator.className = testStatus.fixLoaded ? 'status-indicator status-ok' : 'status-indicator status-loading';
            backIndicator.className = testStatus.backContentCreated ? 'status-indicator status-ok' : 'status-indicator status-loading';
            flipIndicator.className = testStatus.flipFunctionWorking ? 'status-indicator status-ok' : 'status-indicator status-loading';
            
            // æ›´æ–°æ•´ä½“çŠ¶æ€
            const allGood = testStatus.fixLoaded && testStatus.backContentCreated && testStatus.flipFunctionWorking;
            overallIndicator.className = allGood ? 'status-indicator status-ok' : 'status-indicator status-warning';
            
            // æ›´æ–°è¯¦ç»†ä¿¡æ¯
            let details = [];
            if (!testStatus.fixLoaded) details.push('ä¿®å¤è„šæœ¬æœªåŠ è½½');
            if (!testStatus.backContentCreated) details.push('èƒŒé¢å†…å®¹æœªåˆ›å»º');
            if (!testStatus.flipFunctionWorking) details.push('ç¿»è½¬åŠŸèƒ½å¼‚å¸¸');
            if (allGood) details.push('æ‰€æœ‰åŠŸèƒ½æ­£å¸¸');
            
            statusDetails.innerHTML = `<small class="text-muted">${details.join(' | ')}</small>`;
        }
        
        // æ‰§è¡Œä¿®å¤
        function executeFix() {
            console.log('ğŸ”§ æ‰§è¡Œä»»åŠ¡95ä¿®å¤...');
            
            // é‡ç½®çŠ¶æ€
            testStatus = {
                fixLoaded: false,
                backContentCreated: false,
                flipFunctionWorking: false
            };
            updateStatus();
            
            // æ¨¡æ‹Ÿä¿®å¤è¿‡ç¨‹
            setTimeout(() => {
                testStatus.fixLoaded = true;
                updateStatus();
                
                // åˆ›å»ºèƒŒé¢å†…å®¹
                createDemoBackContent();
                
                setTimeout(() => {
                    testStatus.backContentCreated = true;
                    updateStatus();
                    
                    setTimeout(() => {
                        testStatus.flipFunctionWorking = true;
                        updateStatus();
                        
                        document.getElementById('diagnosisInfo').innerHTML = `
                            <div class="alert alert-success">
                                <h6><i class="fas fa-check-circle me-2"></i>ä¿®å¤å®Œæˆ</h6>
                                <ul class="mb-0">
                                    <li>âœ… ä¿®å¤è„šæœ¬å·²åŠ è½½</li>
                                    <li>âœ… èƒŒé¢å†…å®¹å·²åˆ›å»º</li>
                                    <li>âœ… ç¿»è½¬åŠŸèƒ½æ­£å¸¸</li>
                                    <li>âœ… æœ¬ä½“ç ã€æ¡ç ç­‰æ–‡ä»¶ä¿¡æ¯å¯æ­£å¸¸æ˜¾ç¤º</li>
                                </ul>
                            </div>
                        `;
                    }, 500);
                }, 1000);
            }, 500);
        }
        
        // åˆ›å»ºæ¼”ç¤ºç”¨çš„èƒŒé¢å†…å®¹
        function createDemoBackContent() {
            const flipContainer = document.getElementById('task95Demo');
            const existingBack = flipContainer.querySelector('.task-back');
            
            if (existingBack) {
                existingBack.remove();
            }
            
            const taskBack = document.createElement('div');
            taskBack.className = 'task-back';
            taskBack.id = 'task95DemoBack';
            taskBack.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <h5 style="margin: 0 0 15px 0; color: #333;">ğŸ“¦ ä»»åŠ¡æ–‡ä»¶æ¸…å•</h5>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-barcode fa-2x mb-2" style="color: #4361ee;"></i>
                            <div style="font-size: 12px; font-weight: bold;">æœ¬ä½“ç </div>
                            <div style="font-size: 11px; color: #6c757d;">123456789</div>
                        </div>
                        
                        <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-qrcode fa-2x mb-2" style="color: #4cc9f0;"></i>
                            <div style="font-size: 12px; font-weight: bold;">æ¡ç </div>
                            <div style="font-size: 11px; color: #6c757d;">987654321</div>
                        </div>
                        
                        <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-book fa-2x mb-2" style="color: #7209b7;"></i>
                            <div style="font-size: 12px; font-weight: bold;">è¯´æ˜ä¹¦</div>
                            <div style="font-size: 11px; color: #6c757d;">V1.0</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                        <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-exclamation-triangle fa-2x mb-2" style="color: #f72585;"></i>
                            <div style="font-size: 12px; font-weight: bold;">è­¦ç¤ºç </div>
                            <div style="font-size: 11px; color: #6c757d;">WARN001</div>
                        </div>
                        
                        <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <i class="fas fa-tags fa-2x mb-2" style="color: #ef233c;"></i>
                            <div style="font-size: 12px; font-weight: bold;">ç®±å”›</div>
                            <div style="font-size: 11px; color: #6c757d;">BOX001</div>
                        </div>
                    </div>
                    
                    <div style="width: 100%; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-size: 14px; font-weight: bold; color: #333; margin-bottom: 5px;">ä»»åŠ¡ä¿¡æ¯</div>
                        <div style="font-size: 12px; color: #666;">
                            <div>å•†å“åç§°: åŒ–å¦†åŒ…</div>
                            <div>è´§å·: KABI-165</div>
                            <div>æ•°é‡: 1</div>
                            <div>åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-sm btn-outline-secondary mt-3" onclick="event.stopPropagation(); manualFlip()">
                        <i class="fas fa-cube me-1"></i>æŸ¥çœ‹æ­£é¢
                    </button>
                </div>
            `;
            
            flipContainer.appendChild(taskBack);
        }
        
        // æµ‹è¯•ç¿»è½¬
        function testFlip() {
            if (!testStatus.backContentCreated) {
                alert('è¯·å…ˆæ‰§è¡Œä¿®å¤ï¼');
                return;
            }
            
            manualFlip();
            
            // è‡ªåŠ¨ç¿»è½¬å‡ æ¬¡è¿›è¡Œæµ‹è¯•
            let count = 0;
            const maxFlips = 4;
            const flipInterval = setInterval(() => {
                manualFlip();
                count++;
                if (count >= maxFlips) {
                    clearInterval(flipInterval);
                }
            }, 1000);
        }
        
        // æ‰‹åŠ¨ç¿»è½¬
        function manualFlip() {
            const flipContainer = document.getElementById('task95Demo');
            const frontButton = flipContainer.querySelector('.task-front button');
            const backButton = flipContainer.querySelector('.task-back button');
            
            flipContainer.classList.toggle('flipped');
            flipCount++;
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            if (flipContainer.classList.contains('flipped')) {
                if (frontButton) frontButton.textContent = ' æŸ¥çœ‹æ­£é¢';
                if (backButton) backButton.textContent = ' æŸ¥çœ‹æ­£é¢';
            } else {
                if (frontButton) frontButton.textContent = ' æŸ¥çœ‹æ–‡ä»¶';
                if (backButton) backButton.textContent = ' æŸ¥çœ‹æ–‡ä»¶';
            }
            
            console.log(`ğŸ”„ ç¿»è½¬æ¬¡æ•°: ${flipCount}`);
        }
        
        // æ£€æŸ¥çŠ¶æ€
        function checkStatus() {
            const diagnosisInfo = document.getElementById('diagnosisInfo');
            const flipContainer = document.getElementById('task95Demo');
            const backElement = flipContainer.querySelector('.task-back');
            
            let diagnosisHtml = '<div class="alert alert-info"><h6><i class="fas fa-stethoscope me-2"></i>è¯Šæ–­ç»“æœ</h6><ul>';
            
            // æ£€æŸ¥å„é¡¹æŒ‡æ ‡
            const checks = [
                { name: 'ç¿»è½¬å®¹å™¨å­˜åœ¨', passed: !!flipContainer },
                { name: 'èƒŒé¢å…ƒç´ å­˜åœ¨', passed: !!backElement },
                { name: 'ä¿®å¤è„šæœ¬åŠ è½½', passed: typeof window.task95BackContentFixed !== 'undefined' },
                { name: 'ç¿»è½¬åŠŸèƒ½å¯ç”¨', passed: typeof manualFlip === 'function' }
            ];
            
            checks.forEach(check => {
                diagnosisHtml += `<li class="${check.passed ? 'text-success' : 'text-danger'}">
                    ${check.passed ? 'âœ…' : 'âŒ'} ${check.name}
                </li>`;
            });
            
            diagnosisHtml += '</ul></div>';
            diagnosisInfo.innerHTML = diagnosisHtml;
        }
        
        // é‡ç½®æµ‹è¯•
        function resetTest() {
            const flipContainer = document.getElementById('task95Demo');
            flipContainer.classList.remove('flipped');
            
            testStatus = {
                fixLoaded: false,
                backContentCreated: false,
                flipFunctionWorking: false
            };
            
            updateStatus();
            
            document.getElementById('diagnosisInfo').innerHTML = '<p class="text-muted">ç­‰å¾…æ‰§è¡Œè¯Šæ–­...</p>';
            
            console.log('ğŸ”„ æµ‹è¯•å·²é‡ç½®');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ä»»åŠ¡95ç¿»è½¬æµ‹è¯•é¡µé¢å·²åŠ è½½');
            updateStatus();
        });
    </script>
</body>
</html>