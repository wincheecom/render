<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡95èƒŒé¢å†…å®¹ä¿®å¤éªŒè¯</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .status-card {
            margin-bottom: 20px;
        }
        .component-status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .status-ok {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .log-entry {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .log-success { background-color: #d4edda; }
        .log-error { background-color: #f8d7da; }
        .log-info { background-color: #d1ecf1; }
        .log-warning { background-color: #fff3cd; }
        .task-demo {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .control-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="text-center mb-4">
            <h1>ğŸ¯ ä»»åŠ¡95èƒŒé¢å†…å®¹ä¿®å¤éªŒè¯</h1>
            <p class="text-muted">è§£å†³ div#task-95-front.task-front ç¿»è½¬åä¸æ˜¾ç¤ºæœ¬ä½“ç ç­‰é—®é¢˜</p>
        </div>

        <!-- çŠ¶æ€ç›‘æ§é¢æ¿ -->
        <div class="row">
            <div class="col-md-6">
                <div class="status-card card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-heartbeat me-2"></i>å®æ—¶çŠ¶æ€ç›‘æ§</h5>
                    </div>
                    <div class="card-body">
                        <div id="componentStatus">
                            <div class="component-status status-warning">
                                <i class="fas fa-spinner fa-spin me-2"></i>æ­£åœ¨æ£€æµ‹ç»„ä»¶çŠ¶æ€...
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm mt-2" onclick="checkComponents()">
                            <i class="fas fa-sync-alt me-1"></i>åˆ·æ–°çŠ¶æ€
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="status-card card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>æ‰§è¡Œæ—¥å¿—</h5>
                    </div>
                    <div class="card-body">
                        <div id="executionLog" style="height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;">
                            <div class="log-entry log-info">ğŸš€ ä»»åŠ¡95ä¿®å¤éªŒè¯ç³»ç»Ÿå·²å¯åŠ¨...</div>
                        </div>
                        <button class="btn btn-secondary btn-sm mt-2" onclick="clearLogs()">
                            <i class="fas fa-trash me-1"></i>æ¸…ç©ºæ—¥å¿—
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel mb-4">
            <h4><i class="fas fa-sliders-h me-2"></i>ä¿®å¤æ§åˆ¶é¢æ¿</h4>
            <div class="row g-3">
                <div class="col-md-3">
                    <button class="btn btn-success w-100" onclick="executeTask95Fix()">
                        <i class="fas fa-magic me-1"></i>æ‰§è¡Œä¿®å¤
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-warning w-100" onclick="testFlipFunction()">
                        <i class="fas fa-vial me-1"></i>æµ‹è¯•ç¿»è½¬
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-info w-100" onclick="manualFlipTest()">
                        <i class="fas fa-hand-point-up me-1"></i>æ‰‹åŠ¨æµ‹è¯•
                    </button>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-secondary w-100" onclick="resetAll()">
                        <i class="fas fa-undo me-1"></i>é‡ç½®çŠ¶æ€
                    </button>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡95æ¼”ç¤ºåŒºåŸŸ -->
        <div class="task-demo">
            <h4><i class="fas fa-cube me-2"></i>ä»»åŠ¡95ç¿»è½¬æ¼”ç¤º</h4>
            <div class="text-center mb-3">
                <small class="text-muted">ç‚¹å‡»ä¸‹æ–¹å¡ç‰‡æˆ–ä½¿ç”¨æ§åˆ¶é¢æ¿è¿›è¡Œæµ‹è¯•</small>
            </div>
            
            <!-- ä»»åŠ¡95ç¿»è½¬å®¹å™¨ -->
            <div class="task-flip-container mx-auto" data-task-id="95" style="width: 282.66px; height: 307.46px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; perspective: 1500px; cursor: pointer; display: block; will-change: transform;">
                <!-- æ­£é¢ -->
                <div class="task-front" id="task-95-front" data-task-id="95" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; backface-visibility: hidden; z-index: 2; background-color: white; border-radius: 10px; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px; box-sizing: border-box;">
                    <div class="task-gallery-img" style="width: 262.66px; height: 259.06px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; background-color: rgb(248, 249, 250); display: flex; align-items: center; justify-content: center; min-height: 259.06px; max-height: 259.06px;">
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <i class="fas fa-image fa-2x text-muted"></i>
                        </div>
                    </div>
                    <div class="task-card-content d-flex align-items-center gap-2 w-100">
                        <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                            <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">åŒ–å¦†å“åŒ…</div>
                            <div class="task-gallery-code" data-content="KABI-165" style="font-size: 0.75rem; color: #666; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">è´§å·: KABI-165</div>
                            <div class="task-gallery-qty" data-content="1" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 1</div>
                            <div class="task-gallery-creator" data-content="ç®¡ç†å‘˜" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                        </div>
                    </div>
                </div>
                
                <!-- èƒŒé¢ (å°†åœ¨ä¿®å¤ååŠ¨æ€æ·»åŠ ) -->
            </div>
        </div>

        <!-- è¯Šæ–­ä¿¡æ¯ -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-diagnoses me-2"></i>æŠ€æœ¯è¯Šæ–­ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>å…ƒç´ ç»“æ„ä¿¡æ¯</h6>
                        <pre id="structureInfo" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px;">ç­‰å¾…æ£€æµ‹...</pre>
                    </div>
                    <div class="col-md-6">
                        <h6>CSSè®¡ç®—æ ·å¼</h6>
                        <pre id="computedStyles" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; max-height: 200px; overflow-y: auto;">ç­‰å¾…æ£€æµ‹...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="task95_back_content_fix.js"></script>
    <script>
        // æ—¥å¿—ç®¡ç†
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('executionLog');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('executionLog').innerHTML = '';
            addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
        }

        // ç»„ä»¶çŠ¶æ€æ£€æŸ¥
        function checkComponents() {
            addLog('ğŸ” å¼€å§‹ç»„ä»¶çŠ¶æ€æ£€æŸ¥...', 'info');
            
            const statusContainer = document.getElementById('componentStatus');
            statusContainer.innerHTML = '';
            
            // æ£€æŸ¥å„ä¸ªç»„ä»¶
            const components = [
                {
                    name: 'ç¿»è½¬å®¹å™¨',
                    selector: '.task-flip-container[data-task-id="95"]',
                    check: () => document.querySelector('.task-flip-container[data-task-id="95"]')
                },
                {
                    name: 'æ­£é¢å…ƒç´ ',
                    selector: '#task-95-front.task-front',
                    check: () => document.querySelector('#task-95-front.task-front')
                },
                {
                    name: 'èƒŒé¢å…ƒç´ ',
                    selector: '.task-back[data-task-id="95"]',
                    check: () => document.querySelector('.task-back[data-task-id="95"]')
                },
                {
                    name: 'ç¿»è½¬å‡½æ•°',
                    check: () => typeof window.toggleTaskCardFlip === 'function'
                }
            ];
            
            let allGood = true;
            
            components.forEach(comp => {
                const exists = comp.check();
                const statusDiv = document.createElement('div');
                statusDiv.className = `component-status ${exists ? 'status-ok' : 'status-error'}`;
                statusDiv.innerHTML = `
                    <i class="fas ${exists ? 'fa-check-circle' : 'fa-times-circle'} me-2"></i>
                    ${comp.name}: ${exists ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}
                    ${comp.selector ? `<br><small class="text-muted">${comp.selector}</small>` : ''}
                `;
                statusContainer.appendChild(statusDiv);
                
                if (!exists) allGood = false;
                addLog(`${comp.name}: ${exists ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`, exists ? 'success' : 'error');
            });
            
            // æ€»ä½“çŠ¶æ€
            const overallStatus = document.createElement('div');
            overallStatus.className = `component-status ${allGood ? 'status-ok' : 'status-error'}`;
            overallStatus.innerHTML = `
                <i class="fas ${allGood ? 'fa-trophy' : 'fa-exclamation-triangle'} me-2"></i>
                æ€»ä½“çŠ¶æ€: ${allGood ? 'âœ… æ‰€æœ‰ç»„ä»¶æ­£å¸¸' : 'âŒ å­˜åœ¨é—®é¢˜éœ€è¦ä¿®å¤'}
            `;
            statusContainer.appendChild(overallStatus);
            
            addLog(`æ€»ä½“æ£€æŸ¥å®Œæˆ: ${allGood ? 'æ‰€æœ‰ç»„ä»¶æ­£å¸¸' : 'å­˜åœ¨é—®é¢˜'}`, allGood ? 'success' : 'error');
        }

        // æ‰§è¡Œä»»åŠ¡95ä¿®å¤
        function executeTask95Fix() {
            addLog('ğŸš€ å¼€å§‹æ‰§è¡Œä»»åŠ¡95ä¿®å¤...', 'info');
            
            try {
                // å¦‚æœä¿®å¤è„šæœ¬å·²åŠ è½½ï¼Œç›´æ¥è°ƒç”¨
                if (typeof window.executeAllRepairs === 'function') {
                    window.executeAllRepairs();
                    addLog('âœ… ä»»åŠ¡95ä¿®å¤è„šæœ¬å·²æ‰§è¡Œ', 'success');
                } else {
                    // é‡æ–°åŠ è½½è„šæœ¬
                    const script = document.createElement('script');
                    script.src = 'task95_back_content_fix.js';
                    script.onload = () => {
                        addLog('âœ… ä»»åŠ¡95ä¿®å¤è„šæœ¬åŠ è½½å®Œæˆ', 'success');
                        setTimeout(() => {
                            if (typeof window.executeAllRepairs === 'function') {
                                window.executeAllRepairs();
                                addLog('âœ… ä»»åŠ¡95ä¿®å¤å·²æ‰§è¡Œ', 'success');
                            }
                        }, 1000);
                    };
                    document.head.appendChild(script);
                }
                
                // 5ç§’åè‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
                setTimeout(checkComponents, 5000);
                
            } catch (error) {
                addLog(`âŒ æ‰§è¡Œä¿®å¤æ—¶å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç¿»è½¬åŠŸèƒ½
        function testFlipFunction() {
            addLog('ğŸ§ª å¼€å§‹ç¿»è½¬åŠŸèƒ½æµ‹è¯•...', 'info');
            
            try {
                const container = document.querySelector('.task-flip-container[data-task-id="95"]');
                if (!container) {
                    addLog('âŒ æœªæ‰¾åˆ°ç¿»è½¬å®¹å™¨', 'error');
                    return;
                }
                
                const initialState = container.classList.contains('flipped');
                addLog(`åˆå§‹çŠ¶æ€: ${initialState ? 'èƒŒé¢' : 'æ­£é¢'}`, 'info');
                
                // æ‰§è¡Œç¿»è½¬
                if (typeof window.toggleTaskCardFlip === 'function') {
                    window.toggleTaskCardFlip('95');
                    addLog('âœ… ç¿»è½¬å‡½æ•°å·²è°ƒç”¨', 'success');
                    
                    setTimeout(() => {
                        const newState = container.classList.contains('flipped');
                        if (newState !== initialState) {
                            addLog('âœ… ç¿»è½¬åŠŸèƒ½æ­£å¸¸å·¥ä½œ', 'success');
                            
                            // æ£€æŸ¥èƒŒé¢å†…å®¹æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
                            const backElement = container.querySelector('.task-back[data-task-id="95"]');
                            if (backElement) {
                                const hasBodyCode = backElement.innerHTML.includes('æœ¬ä½“ç ');
                                const hasBarcode = backElement.innerHTML.includes('æ¡ç ');
                                const hasManual = backElement.innerHTML.includes('è¯´æ˜ä¹¦');
                                
                                addLog(`èƒŒé¢å†…å®¹æ£€æŸ¥:`, 'info');
                                addLog(`  æœ¬ä½“ç : ${hasBodyCode ? 'âœ… æ˜¾ç¤º' : 'âŒ æœªæ˜¾ç¤º'}`, hasBodyCode ? 'success' : 'error');
                                addLog(`  æ¡ç : ${hasBarcode ? 'âœ… æ˜¾ç¤º' : 'âŒ æœªæ˜¾ç¤º'}`, hasBarcode ? 'success' : 'error');
                                addLog(`  è¯´æ˜ä¹¦: ${hasManual ? 'âœ… æ˜¾ç¤º' : 'âŒ æœªæ˜¾ç¤º'}`, hasManual ? 'success' : 'error');
                            }
                        } else {
                            addLog('âŒ ç¿»è½¬çŠ¶æ€æœªæ”¹å˜', 'error');
                        }
                        
                        // æ¢å¤åŸå§‹çŠ¶æ€
                        if (newState !== initialState) {
                            setTimeout(() => {
                                window.toggleTaskCardFlip('95');
                                addLog('ğŸ”„ å·²æ¢å¤åŸå§‹çŠ¶æ€', 'info');
                            }, 1000);
                        }
                    }, 600);
                } else {
                    addLog('âŒ ç¿»è½¬å‡½æ•°ä¸å­˜åœ¨', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // æ‰‹åŠ¨ç¿»è½¬æµ‹è¯•
        function manualFlipTest() {
            addLog('ğŸ‘† å¯ç”¨æ‰‹åŠ¨ç¿»è½¬æµ‹è¯•æ¨¡å¼...', 'info');
            addLog('è¯·ç›´æ¥ç‚¹å‡»ä¸Šæ–¹çš„ä»»åŠ¡å¡ç‰‡è¿›è¡Œæµ‹è¯•', 'warning');
            
            // ä¸ºå¡ç‰‡æ·»åŠ æ˜æ˜¾çš„ç‚¹å‡»æç¤º
            const card = document.querySelector('.task-flip-container[data-task-id="95"]');
            if (card) {
                card.style.border = '3px solid #007bff';
                card.style.boxShadow = '0 0 20px rgba(0,123,255,0.5)';
                
                setTimeout(() => {
                    card.style.border = '';
                    card.style.boxShadow = '';
                }, 5000);
            }
        }

        // é‡ç½®æ‰€æœ‰çŠ¶æ€
        function resetAll() {
            addLog('ğŸ”„ å¼€å§‹é‡ç½®æ‰€æœ‰çŠ¶æ€...', 'info');
            
            try {
                const container = document.querySelector('.task-flip-container[data-task-id="95"]');
                if (container) {
                    container.classList.remove('flipped');
                    addLog('âœ… ç¿»è½¬çŠ¶æ€å·²é‡ç½®', 'success');
                }
                
                // æ¸…ç†å¯èƒ½çš„å†…è”æ ·å¼
                const front = document.querySelector('#task-95-front');
                if (front) {
                    front.removeAttribute('style');
                    addLog('âœ… æ­£é¢å…ƒç´ æ ·å¼å·²æ¸…ç†', 'success');
                }
                
                addLog('âœ… æ‰€æœ‰çŠ¶æ€é‡ç½®å®Œæˆ', 'success');
                checkComponents();
                
            } catch (error) {
                addLog(`âŒ é‡ç½®è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
            }
        }

        // æ›´æ–°è¯Šæ–­ä¿¡æ¯
        function updateDiagnostics() {
            // æ›´æ–°ç»“æ„ä¿¡æ¯
            const container = document.querySelector('.task-flip-container[data-task-id="95"]');
            const front = document.querySelector('#task-95-front');
            const back = document.querySelector('.task-back[data-task-id="95"]');
            
            let structureInfo = 'å…ƒç´ ç»“æ„ä¿¡æ¯:\n';
            structureInfo += `ç¿»è½¬å®¹å™¨: ${container ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            structureInfo += `æ­£é¢å…ƒç´ : ${front ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            structureInfo += `èƒŒé¢å…ƒç´ : ${back ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            structureInfo += `\nå‡½æ•°çŠ¶æ€:\n`;
            structureInfo += `toggleTaskCardFlip: ${typeof window.toggleTaskCardFlip === 'function' ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`;
            
            document.getElementById('structureInfo').textContent = structureInfo;
            
            // æ›´æ–°è®¡ç®—æ ·å¼
            if (container) {
                const styles = window.getComputedStyle(container);
                let computedInfo = 'å…³é”®CSSå±æ€§:\n';
                computedInfo += `transform-style: ${styles.transformStyle}\n`;
                computedInfo += `perspective: ${styles.perspective}\n`;
                computedInfo += `transition: ${styles.transition}\n`;
                computedInfo += `position: ${styles.position}\n`;
                computedInfo += `cursor: ${styles.cursor}`;
                
                document.getElementById('computedStyles').textContent = computedInfo;
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ¯ ä»»åŠ¡95èƒŒé¢å†…å®¹ä¿®å¤éªŒè¯ç³»ç»Ÿå·²å°±ç»ª', 'success');
            addLog('è¯·ä½¿ç”¨ä¸Šæ–¹æ§åˆ¶é¢æ¿è¿›è¡Œæµ‹è¯•', 'info');
            
            // å®šæœŸæ›´æ–°è¯Šæ–­ä¿¡æ¯
            setInterval(updateDiagnostics, 2000);
            updateDiagnostics();
            
            // åˆå§‹çŠ¶æ€æ£€æŸ¥
            setTimeout(checkComponents, 1000);
        });

        // ä¸ºä»»åŠ¡å¡ç‰‡æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.closest('.task-flip-container[data-task-id="95"]') && 
                !e.target.closest('button, a, input')) {
                addLog('ğŸ–±ï¸ æ£€æµ‹åˆ°å¡ç‰‡ç‚¹å‡»äº‹ä»¶', 'info');
            }
        });
    </script>
</body>
</html>