<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“ä»»åŠ¡å¡å¸ƒå±€çŠ¶æ€è¯Šæ–­</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .diagnosis-container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-success { background-color: #4cc9f0; }
        .status-error { background-color: #ef233c; }
        .status-warning { background-color: #f72585; }
        
        /* æ¨¡æ‹Ÿå½“å‰ç³»ç»Ÿçš„CSS */
        .task-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .task-gallery.warehouse-tasks-gallery {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 8px !important;
            margin-top: 8px !important;
            align-content: start !important;
            width: 100% !important;
            grid-auto-rows: minmax(220px, auto) !important;
        }
        
        .task-flip-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .task-gallery-img {
            width: 100%;
            height: 120px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-info-container {
            text-align: center;
        }
        
        .task-gallery-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 6px;
            color: #333;
        }
        
        .task-gallery-code {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
        }
        
        .task-gallery-qty {
            font-size: 0.85rem;
            color: #4361ee;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="diagnosis-container">
        <h1 class="text-center mb-4">ğŸ” ä»“åº“ä»»åŠ¡å¡å¸ƒå±€çŠ¶æ€è¯Šæ–­</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ å½“å‰ç³»ç»ŸçŠ¶æ€åˆ†æ</h3>
            <div id="systemStatus">
                <p><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åˆ†æç³»ç»ŸçŠ¶æ€...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h3>âœ… å½“å‰å¸ƒå±€æ•ˆæœæ¼”ç¤º</h3>
            <div class="task-gallery warehouse-tasks-gallery" id="currentLayout">
                <!-- è¿™é‡Œå°†åŠ¨æ€æ’å…¥æµ‹è¯•ä»»åŠ¡å¡ç‰‡ -->
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š è¯¦ç»†è¯Šæ–­ç»“æœ</h3>
            <div id="detailedDiagnosis">
                <pre id="cssRules" style="background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
æ­£åœ¨è·å–CSSè§„åˆ™...
                </pre>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ› ï¸ ä¿®å¤å»ºè®®</h3>
            <div id="fixSuggestions">
                <p>åˆ†æå®Œæˆåå°†æ˜¾ç¤ºä¿®å¤å»ºè®®...</p>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ•°æ®
        const testTasks = [
            { id: 'DIAG001', name: 'è¯Šæ–­æµ‹è¯•å•†å“A', code: 'DIAG001', qty: 3, creator: 'ç³»ç»Ÿè¯Šæ–­' },
            { id: 'DIAG002', name: 'è¯Šæ–­æµ‹è¯•å•†å“B', code: 'DIAG002', qty: 1, creator: 'ç³»ç»Ÿè¯Šæ–­' },
            { id: 'DIAG003', name: 'è¯Šæ–­æµ‹è¯•å•†å“C', code: 'DIAG003', qty: 5, creator: 'ç³»ç»Ÿè¯Šæ–­' },
            { id: 'DIAG004', name: 'è¯Šæ–­æµ‹è¯•å•†å“D', code: 'DIAG004', qty: 2, creator: 'ç³»ç»Ÿè¯Šæ–­' },
            { id: 'DIAG005', name: 'è¯Šæ–­æµ‹è¯•å•†å“E', code: 'DIAG005', qty: 7, creator: 'ç³»ç»Ÿè¯Šæ–­' },
            { id: 'DIAG006', name: 'è¯Šæ–­æµ‹è¯•å•†å“F', code: 'DIAG006', qty: 1, creator: 'ç³»ç»Ÿè¯Šæ–­' }
        ];

        // ç”Ÿæˆä»»åŠ¡å¡ç‰‡
        function generateTaskCard(task) {
            return `
                <div class="task-flip-container" data-task-id="${task.id}">
                    <div class="task-front">
                        <div class="task-gallery-img">
                            <i class="fas fa-image fa-2x text-muted"></i>
                        </div>
                        <div class="task-info-container">
                            <div class="task-gallery-name">${task.name}</div>
                            <div class="task-gallery-code">è´§å·: ${task.code}</div>
                            <div class="task-gallery-qty">æ•°é‡: ${task.qty} | ${task.creator}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç³»ç»ŸçŠ¶æ€åˆ†æ
        function analyzeSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let result = '<div class="row">';
            
            // æ£€æŸ¥åŸºæœ¬å…ƒç´ 
            const hasTaskGallery = !!document.querySelector('.task-gallery');
            const hasWarehouseTasksCombo = !!document.querySelector('.task-gallery.warehouse-tasks-gallery');
            const hasGridStyles = getComputedStyle(document.querySelector('.task-gallery.warehouse-tasks-gallery') || {}).display === 'grid';
            
            result += `
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasTaskGallery ? 'status-success' : 'status-error'}"></span> åŸºç¡€.task-gallery: ${hasTaskGallery ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}</p>
                </div>
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasWarehouseTasksCombo ? 'status-success' : 'status-error'}"></span> ç»„åˆé€‰æ‹©å™¨: ${hasWarehouseTasksCombo ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}</p>
                </div>
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasGridStyles ? 'status-success' : 'status-error'}"></span> ç½‘æ ¼å¸ƒå±€: ${hasGridStyles ? 'âœ… å¯ç”¨' : 'âŒ æœªå¯ç”¨'}</p>
                </div>
            `;
            
            result += '</div>';
            statusDiv.innerHTML = result;
        }

        // è·å–CSSè§„åˆ™è¯¦æƒ…
        function getCSSRulesDetails() {
            const cssRulesDiv = document.getElementById('cssRules');
            const galleryElement = document.querySelector('.task-gallery.warehouse-tasks-gallery');
            
            if (!galleryElement) {
                cssRulesDiv.textContent = 'æœªæ‰¾åˆ°ç›®æ ‡å…ƒç´ ';
                return;
            }
            
            const computedStyle = window.getComputedStyle(galleryElement);
            let rulesInfo = '=== å½“å‰è®¡ç®—æ ·å¼ ===\n';
            
            rulesInfo += `display: ${computedStyle.display}\n`;
            rulesInfo += `grid-template-columns: ${computedStyle.gridTemplateColumns}\n`;
            rulesInfo += `gap: ${computedStyle.gap}\n`;
            rulesInfo += `width: ${computedStyle.width}\n`;
            rulesInfo += `align-content: ${computedStyle.alignContent}\n`;
            rulesInfo += `grid-auto-rows: ${computedStyle.gridAutoRows}\n\n`;
            
            // æ£€æŸ¥å…·ä½“çš„CSSè§„åˆ™æ¥æº
            rulesInfo += '=== åŒ¹é…çš„CSSè§„åˆ™ ===\n';
            const sheets = document.styleSheets;
            for (let i = 0; i < sheets.length; i++) {
                try {
                    const rules = sheets[i].cssRules || sheets[i].rules;
                    for (let j = 0; j < rules.length; j++) {
                        const rule = rules[j];
                        if (rule.selectorText && (
                            rule.selectorText.includes('.task-gallery.warehouse-tasks-gallery') ||
                            rule.selectorText.includes('.warehouse-tasks-gallery')
                        )) {
                            rulesInfo += `${rule.selectorText} {\n`;
                            rulesInfo += `  ${rule.style.cssText.replace(/;/g, ';\n  ')}\n`;
                            rulesInfo += `}\n\n`;
                        }
                    }
                } catch (e) {
                    // è·¨åŸŸæ ·å¼è¡¨æ— æ³•è®¿é—®ï¼Œè·³è¿‡
                }
            }
            
            cssRulesDiv.textContent = rulesInfo;
        }

        // è¯Šæ–­å¸ƒå±€é—®é¢˜
        function diagnoseLayoutIssues() {
            const suggestionsDiv = document.getElementById('fixSuggestions');
            const galleryElement = document.querySelector('.task-gallery.warehouse-tasks-gallery');
            
            if (!galleryElement) {
                suggestionsDiv.innerHTML = '<p class="text-danger">âŒ ä¸¥é‡é—®é¢˜ï¼šæœªæ‰¾åˆ°ä»“åº“ä»»åŠ¡å®¹å™¨</p>';
                return;
            }
            
            const computedStyle = window.getComputedStyle(galleryElement);
            let suggestions = '<div class="alert alert-info">';
            suggestions += '<h5>è¯Šæ–­ç»“æœï¼š</h5><ul>';
            
            // æ£€æŸ¥ç½‘æ ¼å¸ƒå±€
            if (computedStyle.display !== 'grid') {
                suggestions += '<li class="text-danger">âŒ displayå±æ€§ä¸æ˜¯grid - éœ€è¦å¼ºåˆ¶è®¾ç½®ä¸ºgrid</li>';
            } else {
                suggestions += '<li class="text-success">âœ… displayå±æ€§æ­£ç¡®è®¾ç½®ä¸ºgrid</li>';
            }
            
            // æ£€æŸ¥åˆ—æ•°
            if (computedStyle.gridTemplateColumns !== 'repeat(3, 1fr)') {
                suggestions += '<li class="text-warning">âš ï¸ åˆ—æ•°è®¾ç½®å¯èƒ½ä¸æ­£ç¡®</li>';
            } else {
                suggestions += '<li class="text-success">âœ… åˆ—æ•°è®¾ç½®æ­£ç¡®(3åˆ—)</li>';
            }
            
            // æ£€æŸ¥é—´è·
            if (computedStyle.gap !== '8px') {
                suggestions += '<li class="text-warning">âš ï¸ é—´è·è®¾ç½®å¯èƒ½ä¸æ­£ç¡®</li>';
            } else {
                suggestions += '<li class="text-success">âœ… é—´è·è®¾ç½®æ­£ç¡®(8px)</li>';
            }
            
            // æ£€æŸ¥å­å…ƒç´ æ’åˆ—
            const taskCards = galleryElement.querySelectorAll('.task-flip-container');
            if (taskCards.length > 0) {
                const firstCardRect = taskCards[0].getBoundingClientRect();
                const secondCardRect = taskCards[1]?.getBoundingClientRect();
                
                if (secondCardRect && Math.abs(firstCardRect.top - secondCardRect.top) < 10) {
                    suggestions += '<li class="text-success">âœ… ä»»åŠ¡å¡ç‰‡æ­£ç¡®æ¨ªå‘æ’åˆ—</li>';
                } else {
                    suggestions += '<li class="text-danger">âŒ ä»»åŠ¡å¡ç‰‡æœªæ­£ç¡®æ¨ªå‘æ’åˆ—</li>';
                }
            }
            
            suggestions += '</ul></div>';
            suggestionsDiv.innerHTML = suggestions;
        }

        // æ¸²æŸ“æµ‹è¯•å¸ƒå±€
        function renderTestLayout() {
            const container = document.getElementById('currentLayout');
            container.innerHTML = '';
            
            testTasks.forEach(task => {
                container.innerHTML += generateTaskCard(task);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œè¯Šæ–­
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ” å¼€å§‹ä»“åº“ä»»åŠ¡å¡å¸ƒå±€è¯Šæ–­...');
            
            // æ¸²æŸ“æµ‹è¯•å†…å®¹
            renderTestLayout();
            
            // å»¶è¿Ÿæ‰§è¡Œå„é¡¹è¯Šæ–­
            setTimeout(() => {
                analyzeSystemStatus();
                getCSSRulesDetails();
                diagnoseLayoutIssues();
            }, 1000);
        });
    </script>
</body>
</html>