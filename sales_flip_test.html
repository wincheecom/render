<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®è¿è¥ä»»åŠ¡å¡ç¿»è½¬åŠŸèƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="targeted_flip_fix.js"></script>
    <style>
        body {
            background-color: #f5f7fb;
            padding: 20px;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .control-panel {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .task-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(282.66px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .status-indicator {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .btn-test {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">ğŸ“‹ é”€å”®è¿è¥ä»»åŠ¡å¡ç¿»è½¬åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="alert alert-info">
            <h4>ğŸ¯ æµ‹è¯•ç›®æ ‡</h4>
            <ul>
                <li>éªŒè¯é”€å”®è¿è¥ä»»åŠ¡å¡ç‰‡çš„ç¿»è½¬åŠŸèƒ½</li>
                <li>æµ‹è¯•èƒŒé¢æ˜¾ç¤ºï¼šæœ¬ä½“ç ã€æ¡ç ã€è­¦ç¤ºç ã€è¯´æ˜ä¹¦ã€ç®±å”›ã€å…¶ä»–æ–‡ä»¶</li>
                <li>éªŒè¯åˆ é™¤æŒ‰é’®åŠŸèƒ½</li>
                <li>ç¡®è®¤ç‚¹å‡»å¡ç‰‡å¯æ­£åé¢åˆ‡æ¢</li>
            </ul>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <h3>ğŸ›ï¸ æ§åˆ¶é¢æ¿</h3>
            <button class="btn btn-primary btn-test" onclick="testAllFlip()">
                <i class="fas fa-sync-alt me-1"></i>æµ‹è¯•å…¨éƒ¨ç¿»è½¬
            </button>
            <button class="btn btn-success btn-test" onclick="resetAllCards()">
                <i class="fas fa-undo me-1"></i>é‡ç½®æ‰€æœ‰å¡ç‰‡
            </button>
            <button class="btn btn-info btn-test" onclick="toggleDebugMode()">
                <i class="fas fa-bug me-1"></i>è°ƒè¯•æ¨¡å¼
            </button>
            <button class="btn btn-warning btn-test" onclick="checkStatus()">
                <i class="fas fa-info-circle me-1"></i>æ£€æŸ¥çŠ¶æ€
            </button>
        </div>
        
        <!-- æµ‹è¯•ç»“æœ -->
        <div id="test-results" class="mb-4">
            <h3>ğŸ“ æµ‹è¯•ç»“æœ</h3>
            <div id="results-content" class="status-indicator info">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
        
        <!-- ä»»åŠ¡å¡ç‰‡å±•ç¤ºåŒº -->
        <div>
            <h3>ğŸ“± é”€å”®è¿è¥ä»»åŠ¡å¡ç‰‡</h3>
            <div class="task-gallery" id="salesTasksGallery">
                <!-- ä»»åŠ¡å¡ç‰‡ 1 - å®Œæ•´æ–‡ä»¶ -->
                <div class="task-flip-container" data-task-id="sales-001">
                    <div class="task-front" id="task-sales-001-front">
                        <div class="task-gallery-img">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-box-open fa-2x text-primary"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge bg-warning text-dark">å¾…å‘</span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name">åŒ–å¦†å“åŒ…</div>
                                <div class="task-gallery-qty">æ•°é‡: 1</div>
                                <div class="task-gallery-creator">åˆ›å»ºäºº: é”€å”®A</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back">
                        <div class="task-back-content">
                            <div class="task-files-container">
                                <div class="task-file-item">
                                    <div class="file-label">æœ¬ä½“ç </div>
                                    <img src="https://placehold.co/80x80/4361ee/white?text=BODY" alt="æœ¬ä½“ç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">æ¡ç </div>
                                    <img src="https://placehold.co/80x80/f72585/white?text=BAR" alt="æ¡ç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è­¦ç¤ºç </div>
                                    <img src="https://placehold.co/80x80/ef233c/white?text=WARN" alt="è­¦ç¤ºç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">ç®±å”›</div>
                                    <img src="https://placehold.co/80x80/4cc9f0/white?text=LABEL" alt="ç®±å”›" class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è¯´æ˜ä¹¦</div>
                                    <div class="pdf-preview">
                                        <i class="fas fa-file-pdf fa-2x"></i>
                                        <div class="pdf-filename">manual.pdf</div>
                                    </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">å…¶ä»–</div>
                                    <img src="https://placehold.co/80x80/7209b7/white?text=OTHER" alt="å…¶ä»–" class="file-preview">
                                </div>
                            </div>
                            <div class="task-back-actions">
                                <div class="back-action-buttons">
                                    <button class="btn btn-danger" onclick="deleteTask('sales-001')">
                                        <i class="fas fa-trash me-1"></i>åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡å¡ç‰‡ 2 - éƒ¨åˆ†æ–‡ä»¶ -->
                <div class="task-flip-container" data-task-id="sales-002">
                    <div class="task-front" id="task-sales-002-front">
                        <div class="task-gallery-img">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-mobile-alt fa-2x text-success"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge bg-primary">å¤„ç†ä¸­</span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name">æ‰‹æœºé…ä»¶</div>
                                <div class="task-gallery-qty">æ•°é‡: 3</div>
                                <div class="task-gallery-creator">åˆ›å»ºäºº: é”€å”®B</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back">
                        <div class="task-back-content">
                            <div class="task-files-container">
                                <div class="task-file-item">
                                    <div class="file-label">æœ¬ä½“ç </div>
                                    <div class="no-file">æœªä¸Šä¼ </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">æ¡ç </div>
                                    <img src="https://placehold.co/80x80/2ecc71/white?text=BAR2" alt="æ¡ç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è­¦ç¤ºç </div>
                                    <div class="no-file">æœªä¸Šä¼ </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">ç®±å”›</div>
                                    <div class="no-file">æœªä¸Šä¼ </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è¯´æ˜ä¹¦</div>
                                    <div class="no-file">æœªä¸Šä¼ </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">å…¶ä»–</div>
                                    <div class="no-file">æœªä¸Šä¼ </div>
                                </div>
                            </div>
                            <div class="task-back-actions">
                                <div class="back-action-buttons">
                                    <button class="btn btn-danger" onclick="deleteTask('sales-002')">
                                        <i class="fas fa-trash me-1"></i>åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡å¡ç‰‡ 3 - æµ‹è¯•ç¿»è½¬ -->
                <div class="task-flip-container" data-task-id="sales-003">
                    <div class="task-front" id="task-sales-003-front">
                        <div class="task-gallery-img">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-laptop fa-2x text-warning"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge bg-success">å·²å®Œæˆ</span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name">ç¬”è®°æœ¬ç”µè„‘</div>
                                <div class="task-gallery-qty">æ•°é‡: 2</div>
                                <div class="task-gallery-creator">åˆ›å»ºäºº: é”€å”®C</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back">
                        <div class="task-back-content">
                            <div class="task-files-container">
                                <div class="task-file-item">
                                    <div class="file-label">æœ¬ä½“ç </div>
                                    <img src="https://placehold.co/80x80/e74c3c/white?text=BODY3" alt="æœ¬ä½“ç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">æ¡ç </div>
                                    <img src="https://placehold.co/80x80/3498db/white?text=BAR3" alt="æ¡ç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è­¦ç¤ºç </div>
                                    <img src="https://placehold.co/80x80/f39c12/white?text=WARN3" alt="è­¦ç¤ºç " class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">ç®±å”›</div>
                                    <img src="https://placehold.co/80x80/9b59b6/white?text=LABEL3" alt="ç®±å”›" class="file-preview">
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">è¯´æ˜ä¹¦</div>
                                    <div class="pdf-preview">
                                        <i class="fas fa-file-pdf fa-2x"></i>
                                        <div class="pdf-filename">manual3.pdf</div>
                                    </div>
                                </div>
                                <div class="task-file-item">
                                    <div class="file-label">å…¶ä»–</div>
                                    <img src="https://placehold.co/80x80/1abc9c/white?text=OTHER3" alt="å…¶ä»–" class="file-preview">
                                </div>
                            </div>
                            <div class="task-back-actions">
                                <div class="back-action-buttons">
                                    <button class="btn btn-danger" onclick="deleteTask('sales-003')">
                                        <i class="fas fa-trash me-1"></i>åˆ é™¤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let debugMode = false;
        let testResults = [];
        
        // æµ‹è¯•å‡½æ•°
        function testAllFlip() {
            addTestResult('ğŸ”„ å¼€å§‹æµ‹è¯•å…¨éƒ¨ç¿»è½¬åŠŸèƒ½...', 'info');
            
            const containers = document.querySelectorAll('.task-flip-container');
            let completed = 0;
            
            containers.forEach((container, index) => {
                const taskId = container.dataset.taskId;
                setTimeout(() => {
                    if (window.toggleTaskCardFlip) {
                        window.toggleTaskCardFlip(taskId);
                        addTestResult(`âœ… ä»»åŠ¡ ${taskId} ç¿»è½¬æµ‹è¯•å®Œæˆ`, 'success');
                        completed++;
                        
                        // 2ç§’åç¿»è½¬å›æ¥
                        setTimeout(() => {
                            window.toggleTaskCardFlip(taskId);
                            addTestResult(`â†©ï¸ ä»»åŠ¡ ${taskId} å¤ä½å®Œæˆ`, 'info');
                            
                            if (completed === containers.length) {
                                addTestResult('ğŸ‰ å…¨éƒ¨ç¿»è½¬æµ‹è¯•å®Œæˆï¼', 'success');
                            }
                        }, 2000);
                    } else {
                        addTestResult(`âŒ ä»»åŠ¡ ${taskId} ç¿»è½¬åŠŸèƒ½ä¸å¯ç”¨`, 'error');
                    }
                }, index * 1000);
            });
        }
        
        function resetAllCards() {
            const containers = document.querySelectorAll('.task-flip-container');
            containers.forEach(container => {
                container.classList.remove('flipped');
            });
            addTestResult('â†©ï¸ æ‰€æœ‰å¡ç‰‡å·²é‡ç½®åˆ°æ­£é¢', 'success');
        }
        
        function toggleDebugMode() {
            debugMode = !debugMode;
            const containers = document.querySelectorAll('.task-flip-container');
            const fronts = document.querySelectorAll('.task-front');
            const backs = document.querySelectorAll('.task-back');
            
            containers.forEach(el => el.classList.toggle('debug-mode', debugMode));
            fronts.forEach(el => el.classList.toggle('debug-mode', debugMode));
            backs.forEach(el => el.classList.toggle('debug-mode', debugMode));
            
            addTestResult(`ğŸ” è°ƒè¯•æ¨¡å¼: ${debugMode ? 'å¼€å¯' : 'å…³é—­'}`, 'info');
        }
        
        function checkStatus() {
            const status = window.SalesOperationsFlipFix ? 
                window.SalesOperationsFlipFix.getStatus() : 
                { initialized: false, taskCount: 0 };
                
            addTestResult(`ğŸ“Š ç³»ç»ŸçŠ¶æ€: ${status.initialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`, 'info');
            addTestResult(`ğŸ“Š ä»»åŠ¡å¡ç‰‡æ•°: ${status.taskCount}`, 'info');
            
            if (status.flipStates && status.flipStates.length > 0) {
                status.flipStates.forEach(([taskId, flipped]) => {
                    addTestResult(`ğŸ“Š ä»»åŠ¡ ${taskId}: ${flipped ? 'èƒŒé¢' : 'æ­£é¢'}`, 'info');
                });
            }
        }
        
        function deleteTask(taskId) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡ ${taskId} å—ï¼Ÿ`)) {
                addTestResult(`ğŸ—‘ï¸ ä»»åŠ¡ ${taskId} å·²åˆ é™¤`, 'warning');
                const container = document.querySelector(`.task-flip-container[data-task-id="${taskId}"]`);
                if (container) {
                    container.style.opacity = '0';
                    container.style.transform = 'scale(0.8)';
                    setTimeout(() => container.remove(), 300);
                }
            }
        }
        
        function addTestResult(message, type = 'info') {
            const resultsContent = document.getElementById('results-content');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status-indicator ${type}`;
            resultDiv.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            
            if (resultsContent.innerHTML.includes('ç­‰å¾…æµ‹è¯•å¼€å§‹...')) {
                resultsContent.innerHTML = '';
            }
            
            resultsContent.appendChild(resultDiv);
            resultsContent.scrollTop = resultsContent.scrollHeight;
            
            // è®°å½•åˆ°æ•°ç»„
            testResults.push({
                time: new Date(),
                message: message,
                type: type
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œç¿»è½¬åŠŸèƒ½ä¿®å¤è„šæœ¬å·²åŠ è½½', 'success');
            
            // æ£€æŸ¥ä¿®å¤è„šæœ¬æ˜¯å¦æ­£ç¡®åŠ è½½
            setTimeout(() => {
                if (window.SalesOperationsFlipFix) {
                    addTestResult('âœ… é”€å”®è¿è¥ç¿»è½¬ä¿®å¤è„šæœ¬åŠ è½½æˆåŠŸ', 'success');
                } else {
                    addTestResult('âŒ é”€å”®è¿è¥ç¿»è½¬ä¿®å¤è„šæœ¬åŠ è½½å¤±è´¥', 'error');
                }
            }, 1000);
        });
        
        // ç›‘å¬ç¿»è½¬äº‹ä»¶
        document.addEventListener('salesTaskCardFlipped', function(e) {
            const { taskId, flipped } = e.detail;
            addTestResult(`ğŸ”„ ä»»åŠ¡ ${taskId} ç¿»è½¬åˆ°${flipped ? 'èƒŒé¢' : 'æ­£é¢'}`, 'info');
        });
    </script>
</body>
</html>