<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´§æ€¥ç¿»è½¬ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f5f7fb;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .result-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .task-demo {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">
            <i class="fas fa-tools me-2"></i>
            ç´§æ€¥ç¿»è½¬ä¿®å¤æµ‹è¯•
        </h1>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="result-panel">
            <h3><i class="fas fa-gamepad me-2"></i>æ§åˆ¶é¢æ¿</h3>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary w-100 mb-2" onclick="executeEmergencyFix()">
                        <i class="fas fa-bolt me-2"></i>æ‰§è¡Œç´§æ€¥ä¿®å¤
                    </button>
                    <button class="btn btn-info w-100 mb-2" onclick="testFlip()">
                        <i class="fas fa-sync-alt me-2"></i>æµ‹è¯•ç¿»è½¬
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-success w-100 mb-2" onclick="checkStatus()">
                        <i class="fas fa-search me-2"></i>æ£€æŸ¥çŠ¶æ€
                    </button>
                    <button class="btn btn-warning w-100 mb-2" onclick="resetDemo()">
                        <i class="fas fa-redo me-2"></i>é‡ç½®æ¼”ç¤º
                    </button>
                </div>
            </div>
        </div>
        
        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="result-panel">
            <h3><i class="fas fa-clipboard-check me-2"></i>å½“å‰çŠ¶æ€</h3>
            <div id="status-display">
                <p class="text-muted">ç‚¹å‡»"æ£€æŸ¥çŠ¶æ€"å¼€å§‹æ£€æµ‹...</p>
            </div>
        </div>
        
        <!-- æ¼”ç¤ºä»»åŠ¡å¡ç‰‡ -->
        <div class="task-demo">
            <h3><i class="fas fa-tasks me-2"></i>æ¼”ç¤ºä»»åŠ¡å¡ç‰‡ #96</h3>
            <p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„ä»»åŠ¡å¡ç‰‡ï¼Œç”¨äºæµ‹è¯•ç¿»è½¬åŠŸèƒ½ï¼š</p>
            
            <div class="task-flip-container" data-task-id="96" id="demo-task-96" style="width: 282.66px; height: 307.46px; margin: 20px auto;">
                <div class="task-front" id="task-96-front" data-task-id="96" 
                     style="position: relative !important; width: 100% !important; max-width: 282.66px !important; height: auto !important; min-height: 307.46px !important; margin: 0px !important; padding: 10px !important; box-sizing: border-box !important; z-index: 1 !important;">
                    <div class="task-gallery-img" style="width: 262.66px !important; height: 259.06px !important; object-fit: cover !important; border-radius: 6px !important; margin-bottom: 8px !important; background-color: rgb(248, 249, 250) !important; display: flex !important; align-items: center !important; justify-content: center !important; min-height: 259.06px !important; max-height: 259.06px !important;">
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <i class="fas fa-image fa-2x text-muted"></i>
                        </div>
                    </div>
                    <div class="task-card-content d-flex align-items-center gap-2 w-100">
                        <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                            <span class="badge bg-warning" style="padding: 2px 6px; font-size: 0.7rem; min-width: 40px; text-align: center;">
                                å¾…å‘
                            </span>
                        </div>
                        <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                            <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">ç«‹ä½“æ‹¼å›¾äº¤é€š</div>
                            <div class="task-gallery-qty" data-content="1" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 1</div>
                            <div class="task-gallery-creator" data-content="ç®¡ç†å‘˜" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                        </div>
                    </div>
                </div>
                <div class="task-back" data-task-id="96" style="display: none;">
                    <div class="task-back-content" style="padding: 15px; height: 100%; display: flex; flex-direction: column;">
                        <h5 style="margin: 0 0 15px 0;">ä»»åŠ¡è¯¦æƒ…</h5>
                        <div class="task-files-preview" style="flex: 1; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                            <div class="file-item" style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.85rem;">
                                <i class="fas fa-barcode"></i>
                                <span>æœ¬ä½“ç </span>
                            </div>
                            <div class="file-item" style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.85rem;">
                                <i class="fas fa-qrcode"></i>
                                <span>æ¡ç </span>
                            </div>
                            <div class="file-item" style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.85rem;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>è­¦ç¤ºç </span>
                            </div>
                            <div class="file-item" style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.85rem;">
                                <i class="fas fa-box"></i>
                                <span>ç®±å”›</span>
                            </div>
                            <div class="file-item" style="display: flex; align-items: center; gap: 8px; padding: 8px; background-color: #f8f9fa; border-radius: 6px; font-size: 0.85rem;">
                                <i class="fas fa-book"></i>
                                <span>è¯´æ˜ä¹¦</span>
                            </div>
                        </div>
                        <div class="task-back-actions" style="display: flex; gap: 10px; justify-content: space-between; margin-top: auto;">
                            <button class="btn btn-outline-secondary btn-sm" onclick="toggleTaskCardFlip('96')" style="padding: 5px 10px; border: 1px solid #6c757d; background: white; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-arrow-left me-1"></i>è¿”å›
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="completeShipment('96')" style="padding: 5px 10px; background: #0d6efd; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-truck me-1"></i>ç¡®è®¤å‘è´§
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="result-panel">
            <h3><i class="fas fa-terminal me-2"></i>æ‰§è¡Œæ—¥å¿—</h3>
            <div id="log-output" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; height: 300px; overflow-y: auto;">
                <p class="text-muted">æ—¥å¿—è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="console_fix_script.js"></script>
    <script>
        // æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = {
                'success': 'text-success',
                'error': 'text-danger',
                'warning': 'text-warning',
                'info': 'text-info'
            }[type] || 'text-dark';
            
            logDiv.innerHTML += `<div class="${typeClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // çŠ¶æ€æ˜¾ç¤ºå‡½æ•°
        function addStatus(title, status, message) {
            const statusDiv = document.getElementById('status-display');
            const statusClass = {
                'success': 'status-success',
                'error': 'status-error',
                'warning': 'status-warning',
                'info': 'status-info'
            }[status];
            
            statusDiv.innerHTML += `
                <div class="mb-2">
                    <span class="status-indicator ${statusClass}"></span>
                    <strong>${title}:</strong> ${message}
                </div>
            `;
        }
        
        // æ‰§è¡Œç´§æ€¥ä¿®å¤
        function executeEmergencyFix() {
            addLog('å¼€å§‹æ‰§è¡Œç´§æ€¥ç¿»è½¬ä¿®å¤...', 'info');
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = '<p class="text-muted">æ­£åœ¨æ‰§è¡Œä¿®å¤ä¸­...</p>';
            
            try {
                // æ‰§è¡Œä¿®å¤è„šæœ¬
                const result = (function() {
                    // è¿™é‡Œå¤åˆ¶ console_fix_script.js çš„æ ¸å¿ƒé€»è¾‘
                    console.log('ğŸš€ å¼€å§‹æ‰§è¡Œé”€å”®è¿è¥ä»»åŠ¡å¡ç¿»è½¬ç´§æ€¥ä¿®å¤...');
                    
                    // æ­¥éª¤1: æ¸…ç†å†²çªæ ·å¼
                    const task96Front = document.querySelector('#task-96-front.task-front');
                    if (task96Front) {
                        const originalStyle = task96Front.getAttribute('style') || '';
                        task96Front.setAttribute('data-original-style', originalStyle);
                        task96Front.removeAttribute('style');
                        addLog('âœ… å†²çªæ ·å¼å·²æ¸…ç†', 'success');
                    }
                    
                    // æ­¥éª¤2: åº”ç”¨ä¿®å¤æ ·å¼
                    let styleSheet = document.getElementById('emergency-demo-styles');
                    if (!styleSheet) {
                        styleSheet = document.createElement('style');
                        styleSheet.id = 'emergency-demo-styles';
                        styleSheet.textContent = `
                            .task-flip-container[data-task-id="96"] {
                                perspective: 1500px !important;
                                transform-style: preserve-3d !important;
                                transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1) !important;
                                position: relative !important;
                                cursor: pointer !important;
                                width: 282.66px !important;
                                height: 307.46px !important;
                                display: block !important;
                                will-change: transform !important;
                                transform-origin: center center !important;
                            }
                            
                            .task-flip-container[data-task-id="96"] .task-front,
                            .task-flip-container[data-task-id="96"] .task-back {
                                backface-visibility: hidden !important;
                                position: absolute !important;
                                top: 0 !important;
                                left: 0 !important;
                                width: 100% !important;
                                height: 100% !important;
                                box-sizing: border-box !important;
                                border-radius: 10px !important;
                                background-color: white !important;
                            }
                            
                            .task-flip-container[data-task-id="96"] .task-front {
                                z-index: 2 !important;
                                transform: rotateY(0deg) !important;
                            }
                            
                            .task-flip-container[data-task-id="96"] .task-back {
                                transform: rotateY(180deg) !important;
                                z-index: 1 !important;
                                display: block !important;
                            }
                            
                            .task-flip-container[data-task-id="96"].flipped {
                                transform: rotateY(180deg) !important;
                            }
                            
                            .task-flip-container[data-task-id="96"].flipped .task-front {
                                transform: rotateY(0deg) !important;
                                z-index: 1 !important;
                            }
                            
                            .task-flip-container[data-task-id="96"].flipped .task-back {
                                transform: rotateY(180deg) !important;
                                z-index: 2 !important;
                            }
                        `;
                        document.head.appendChild(styleSheet);
                        addLog('âœ… ä¿®å¤æ ·å¼å·²åº”ç”¨', 'success');
                    }
                    
                    // æ­¥éª¤3: ç¡®ä¿ç¿»è½¬å‡½æ•°
                    window.toggleTaskCardFlip = function(taskId) {
                        if (taskId !== '96') return;
                        
                        const flipContainer = document.querySelector('.task-flip-container[data-task-id="96"]');
                        if (flipContainer) {
                            flipContainer.classList.toggle('flipped');
                            const isFlipped = flipContainer.classList.contains('flipped');
                            addLog(`âœ… ä»»åŠ¡${taskId}ç¿»è½¬çŠ¶æ€: ${isFlipped ? 'èƒŒé¢' : 'æ­£é¢'}`, 'success');
                        }
                    };
                    
                    // æ­¥éª¤4: æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    const container = document.querySelector('.task-flip-container[data-task-id="96"]');
                    if (container) {
                        container.addEventListener('click', function(e) {
                            if (!e.target.closest('button')) {
                                window.toggleTaskCardFlip('96');
                            }
                        });
                        addLog('âœ… ç‚¹å‡»äº‹ä»¶å·²ç»‘å®š', 'success');
                    }
                    
                    return true;
                })();
                
                if (result) {
                    addLog('ğŸ‰ ç´§æ€¥ä¿®å¤æ‰§è¡Œå®Œæˆï¼', 'success');
                    setTimeout(checkStatus, 1000);
                } else {
                    addLog('âŒ ç´§æ€¥ä¿®å¤æ‰§è¡Œå¤±è´¥', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ æ‰§è¡Œå‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // æµ‹è¯•ç¿»è½¬
        function testFlip() {
            addLog('å¼€å§‹æµ‹è¯•ç¿»è½¬åŠŸèƒ½...', 'info');
            
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (!container) {
                addLog('âŒ æœªæ‰¾åˆ°ä»»åŠ¡å®¹å™¨', 'error');
                return;
            }
            
            // æµ‹è¯•ç¿»è½¬åˆ°èƒŒé¢
            addLog('æ‰§è¡Œç¿»è½¬åˆ°èƒŒé¢...', 'info');
            window.toggleTaskCardFlip('96');
            
            setTimeout(() => {
                const isFlipped = container.classList.contains('flipped');
                if (isFlipped) {
                    addLog('âœ… ç¿»è½¬åˆ°èƒŒé¢æˆåŠŸ', 'success');
                    
                    // æµ‹è¯•ç¿»è½¬å›æ­£é¢
                    setTimeout(() => {
                        addLog('æ‰§è¡Œç¿»è½¬å›æ­£é¢...', 'info');
                        window.toggleTaskCardFlip('96');
                        
                        setTimeout(() => {
                            const isBack = container.classList.contains('flipped');
                            if (!isBack) {
                                addLog('âœ… ç¿»è½¬å›æ­£é¢æˆåŠŸ', 'success');
                                addLog('ğŸ‰ å®Œæ•´ç¿»è½¬æµ‹è¯•é€šè¿‡ï¼', 'success');
                            } else {
                                addLog('âŒ ç¿»è½¬å›æ­£é¢å¤±è´¥', 'error');
                            }
                        }, 600);
                    }, 1000);
                } else {
                    addLog('âŒ ç¿»è½¬åˆ°èƒŒé¢å¤±è´¥', 'error');
                }
            }, 600);
        }
        
        // æ£€æŸ¥çŠ¶æ€
        function checkStatus() {
            addLog('å¼€å§‹æ£€æŸ¥å½“å‰çŠ¶æ€...', 'info');
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = '';
            
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            const front = document.querySelector('#task-96-front.task-front');
            const back = document.querySelector('.task-back[data-task-id="96"]');
            const hasFlipFunction = typeof window.toggleTaskCardFlip === 'function';
            const hasStyles = !!document.getElementById('emergency-demo-styles');
            
            addStatus('ç¿»è½¬å®¹å™¨', container ? 'success' : 'error', container ? 'å­˜åœ¨' : 'ç¼ºå¤±');
            addStatus('æ­£é¢å…ƒç´ ', front ? 'success' : 'error', front ? 'å­˜åœ¨' : 'ç¼ºå¤±');
            addStatus('èƒŒé¢å…ƒç´ ', back ? 'success' : 'warning', back ? 'å­˜åœ¨' : 'ç¼ºå¤±ï¼ˆå°†è‡ªåŠ¨åˆ›å»ºï¼‰');
            addStatus('ç¿»è½¬å‡½æ•°', hasFlipFunction ? 'success' : 'error', hasFlipFunction ? 'å¯ç”¨' : 'ä¸å¯ç”¨');
            addStatus('ä¿®å¤æ ·å¼', hasStyles ? 'success' : 'info', hasStyles ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
            
            const issues = [];
            if (!container) issues.push('ç¼ºå°‘ç¿»è½¬å®¹å™¨');
            if (!front) issues.push('ç¼ºå°‘æ­£é¢å…ƒç´ ');
            if (!hasFlipFunction) issues.push('ç¿»è½¬å‡½æ•°ç¼ºå¤±');
            
            if (issues.length === 0) {
                addStatus('æ€»ä½“è¯„ä¼°', 'success', 'âœ… ç³»ç»ŸçŠ¶æ€è‰¯å¥½ï¼Œç¿»è½¬åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ');
            } else {
                addStatus('æ€»ä½“è¯„ä¼°', 'warning', `âš ï¸ å‘ç° ${issues.length} ä¸ªé—®é¢˜: ${issues.join(', ')}`);
            }
            
            addLog(`çŠ¶æ€æ£€æŸ¥å®Œæˆï¼Œå‘ç°é—®é¢˜: ${issues.length} ä¸ª`, issues.length === 0 ? 'success' : 'warning');
        }
        
        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            addLog('é‡ç½®æ¼”ç¤ºç¯å¢ƒ...', 'info');
            
            // ç§»é™¤ä¿®å¤æ ·å¼
            const fixStyles = document.getElementById('emergency-demo-styles');
            if (fixStyles) {
                fixStyles.remove();
                addLog('å·²ç§»é™¤ä¿®å¤æ ·å¼', 'info');
            }
            
            // é‡ç½®ç¿»è½¬çŠ¶æ€
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (container) {
                container.classList.remove('flipped');
                addLog('å·²é‡ç½®ç¿»è½¬çŠ¶æ€', 'info');
            }
            
            // æ¸…ç©ºçŠ¶æ€æ˜¾ç¤º
            document.getElementById('status-display').innerHTML = '<p class="text-muted">ç‚¹å‡»"æ£€æŸ¥çŠ¶æ€"å¼€å§‹æ£€æµ‹...</p>';
            
            addLog('æ¼”ç¤ºç¯å¢ƒé‡ç½®å®Œæˆ', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            addLog('ç´§æ€¥ç¿»è½¬ä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            addLog('è¯·å…ˆç‚¹å‡»"æ£€æŸ¥çŠ¶æ€"ï¼Œç„¶åæ‰§è¡Œ"ç´§æ€¥ä¿®å¤"', 'info');
        });
    </script>
</body>
</html>