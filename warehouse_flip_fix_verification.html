<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“å‘è´§ä»»åŠ¡å¡ç¿»è½¬åŠŸèƒ½ä¿®å¤éªŒè¯</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .task-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .task-flip-container {
            position: relative;
            width: 100%;
            height: 300px;
            transform-style: preserve-3d;
            perspective: 1000px;
            transition: transform 0.6s;
            cursor: pointer;
        }
        .task-flip-container.flipped {
            transform: rotateY(180deg);
        }
        .task-front, .task-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 20px;
            box-sizing: border-box;
        }
        .task-back {
            transform: rotateY(180deg);
            background: #f8f9fa;
        }
        .test-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ready { background-color: #27ae60; }
        .status-testing { background-color: #f39c12; }
        .status-error { background-color: #e74c3c; }
        .status-success { background-color: #2ecc71; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4"><i class="fas fa-vial"></i> ä»“åº“å‘è´§ä»»åŠ¡å¡ç¿»è½¬åŠŸèƒ½ä¿®å¤éªŒè¯</h1>
        
        <div class="status-section mb-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">æµ‹è¯•çŠ¶æ€</h5>
                    <p><span class="status-indicator status-ready" id="overallStatus"></span> 
                       æ•´ä½“çŠ¶æ€: <span id="statusText">å‡†å¤‡å°±ç»ª</span></p>
                    <p>ä¿®å¤ç‰ˆæœ¬: ç»¼åˆæ€§å¢å¼ºç‰ˆ</p>
                    <p>æµ‹è¯•ç›®æ ‡: éªŒè¯å‘è´§åç¬¬äºŒå¼ å¡ç‰‡ç¿»è½¬åŠŸèƒ½</p>
                </div>
            </div>
        </div>

        <div class="test-controls">
            <h3><i class="fas fa-sliders-h"></i> æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary me-2" onclick="runFullTestSequence()">
                        <i class="fas fa-play"></i> è¿è¡Œå®Œæ•´æµ‹è¯•åºåˆ—
                    </button>
                    <button class="btn btn-info me-2" onclick="runIndividualTests()">
                        <i class="fas fa-list"></i> åˆ†æ­¥æµ‹è¯•
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-warning me-2" onclick="resetAllTests()">
                        <i class="fas fa-redo"></i> é‡ç½®æµ‹è¯•
                    </button>
                    <button class="btn btn-danger" onclick="clearTestLog()">
                        <i class="fas fa-trash"></i> æ¸…æ—¥å¿—
                    </button>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="autoApplyFixes" checked>
                    <label class="form-check-label" for="autoApplyFixes">è‡ªåŠ¨åº”ç”¨ä¿®å¤</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="showDetailedLogs" checked>
                    <label class="form-check-label" for="showDetailedLogs">è¯¦ç»†æ—¥å¿—</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="enableAutoRecovery" checked>
                    <label class="form-check-label" for="enableAutoRecovery">å¯ç”¨è‡ªåŠ¨æ¢å¤</label>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="card task-card">
                    <div class="card-body">
                        <h5>ä»»åŠ¡å¡ 1 (TASK001)</h5>
                        <div class="task-flip-container" data-task-id="TASK001" id="task-container-1">
                            <div class="task-front" id="task-TASK001-front">
                                <h6><i class="fas fa-box"></i> ä»»åŠ¡ä¿¡æ¯</h6>
                                <p><strong>ä»»åŠ¡ç¼–å·:</strong> TASK001</p>
                                <p><strong>å•†å“:</strong> æµ‹è¯•å•†å“A</p>
                                <p><strong>æ•°é‡:</strong> 2ä»¶</p>
                                <p><strong>çŠ¶æ€:</strong> <span class="badge bg-warning">å¾…å¤„ç†</span></p>
                                <button class="btn btn-sm btn-primary mt-2" data-task-id="TASK001" data-action="flip">
                                    <i class="fas fa-truck"></i> å¤„ç†å‘è´§
                                </button>
                            </div>
                            <div class="task-back">
                                <h6><i class="fas fa-file-alt"></i> å‘è´§è¯¦æƒ…</h6>
                                <p>è¯·ç¡®è®¤ä»¥ä¸‹å‘è´§ä¿¡æ¯ï¼š</p>
                                <ul>
                                    <li>å•†å“A Ã— 2ä»¶</li>
                                    <li>åŒ…è£…å®Œå¥½</li>
                                    <li>ç‰©æµå•å·å·²ç”Ÿæˆ</li>
                                </ul>
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-secondary me-2" data-task-id="TASK001" data-action="flip">
                                        <i class="fas fa-arrow-left"></i> è¿”å›
                                    </button>
                                    <button class="btn btn-sm btn-success" data-task-id="TASK001" data-action="complete-shipment">
                                        <i class="fas fa-check"></i> ç¡®è®¤å‘è´§
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card task-card">
                    <div class="card-body">
                        <h5>ä»»åŠ¡å¡ 2 (TASK002)</h5>
                        <div class="task-flip-container" data-task-id="TASK002" id="task-container-2">
                            <div class="task-front" id="task-TASK002-front">
                                <h6><i class="fas fa-box"></i> ä»»åŠ¡ä¿¡æ¯</h6>
                                <p><strong>ä»»åŠ¡ç¼–å·:</strong> TASK002</p>
                                <p><strong>å•†å“:</strong> æµ‹è¯•å•†å“B</p>
                                <p><strong>æ•°é‡:</strong> 1ä»¶</p>
                                <p><strong>çŠ¶æ€:</strong> <span class="badge bg-warning">å¾…å¤„ç†</span></p>
                                <button class="btn btn-sm btn-primary mt-2" data-task-id="TASK002" data-action="flip">
                                    <i class="fas fa-truck"></i> å¤„ç†å‘è´§
                                </button>
                            </div>
                            <div class="task-back">
                                <h6><i class="fas fa-file-alt"></i> å‘è´§è¯¦æƒ…</h6>
                                <p>è¯·ç¡®è®¤ä»¥ä¸‹å‘è´§ä¿¡æ¯ï¼š</p>
                                <ul>
                                    <li>å•†å“B Ã— 1ä»¶</li>
                                    <li>åŒ…è£…å®Œå¥½</li>
                                    <li>ç‰©æµå•å·å·²ç”Ÿæˆ</li>
                                </ul>
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-secondary me-2" data-task-id="TASK002" data-action="flip">
                                        <i class="fas fa-arrow-left"></i> è¿”å›
                                    </button>
                                    <button class="btn btn-sm btn-success" data-task-id="TASK002" data-action="complete-shipment">
                                        <i class="fas fa-check"></i> ç¡®è®¤å‘è´§
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-area" id="testLog">
            <div class="text-muted">æµ‹è¯•æ—¥å¿—å°†åœ¨æ­¤æ˜¾ç¤º...</div>
        </div>
    </div>

    <script src="comprehensive_warehouse_flip_fix.js"></script>
    <script src="deep_diagnosis_warehouse_flip.js"></script>
    
    <script>
        // æµ‹è¯•çŠ¶æ€ç®¡ç†
        let testState = {
            currentStep: 0,
            totalSteps: 0,
            results: [],
            startTime: null
        };

        // æ—¥å¿—è®°å½•å‡½æ•°
        function logTest(message, type = 'info') {
            const logArea = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = {
                'info': 'text-info',
                'success': 'text-success',
                'warning': 'text-warning',
                'error': 'text-danger'
            }[type] || 'text-white';
            
            const logEntry = `<div class="${typeClass}">[${timestamp}] ${message}</div>`;
            logArea.innerHTML += logEntry;
            logArea.scrollTop = logArea.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
            console.log(`[TEST] ${message}`);
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(status, text) {
            const indicator = document.getElementById('overallStatus');
            const statusText = document.getElementById('statusText');
            
            indicator.className = `status-indicator status-${status}`;
            statusText.textContent = text;
        }

        // æ¨¡æ‹Ÿç¿»è½¬å‡½æ•°ï¼ˆç”¨äºæµ‹è¯•ï¼‰
        function simulateToggleTaskCardFlip(taskId) {
            logTest(`ğŸ”„ æ¨¡æ‹Ÿç¿»è½¬ä»»åŠ¡å¡: ${taskId}`, 'info');
            
            const container = document.querySelector(`.task-flip-container[data-task-id="${taskId}"]`);
            if (container) {
                container.classList.toggle('flipped');
                const isFlipped = container.classList.contains('flipped');
                logTest(`âœ… ä»»åŠ¡å¡ ${taskId} ç¿»è½¬${isFlipped ? 'åˆ°èƒŒé¢' : 'åˆ°æ­£é¢'}`, 'success');
                
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                const buttons = container.querySelectorAll(`[data-task-id="${taskId}"][data-action="flip"]`);
                buttons.forEach(button => {
                    if (isFlipped) {
                        button.innerHTML = '<i class="fas fa-arrow-left"></i> è¿”å›';
                    } else {
                        button.innerHTML = '<i class="fas fa-truck"></i> å¤„ç†å‘è´§';
                    }
                });
                
                return true;
            } else {
                logTest(`âŒ æœªæ‰¾åˆ°ä»»åŠ¡å¡: ${taskId}`, 'error');
                return false;
            }
        }

        // æ¨¡æ‹Ÿå‘è´§å®Œæˆ
        function simulateCompleteShipment(taskId) {
            logTest(`ğŸ“¦ æ¨¡æ‹Ÿå®Œæˆå‘è´§: ${taskId}`, 'info');
            
            const container = document.querySelector(`.task-flip-container[data-task-id="${taskId}"]`);
            if (container) {
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                const badge = container.querySelector('.badge');
                if (badge) {
                    badge.textContent = 'å·²å‘è´§';
                    badge.classList.remove('bg-warning');
                    badge.classList.add('bg-success');
                }
                
                // ç¦ç”¨æŒ‰é’®
                const buttons = container.querySelectorAll(`[data-task-id="${taskId}"]`);
                buttons.forEach(button => {
                    button.disabled = true;
                    button.style.opacity = '0.5';
                    button.style.cursor = 'not-allowed';
                    if (button.hasAttribute('data-action')) {
                        button.textContent = 'å·²å‘è´§';
                    }
                });
                
                logTest(`âœ… ä»»åŠ¡ ${taskId} å‘è´§å®Œæˆ`, 'success');
                return true;
            } else {
                logTest(`âŒ æœªæ‰¾åˆ°ä»»åŠ¡å¡: ${taskId}`, 'error');
                return false;
            }
        }

        // é‡ç½®æµ‹è¯•çŠ¶æ€
        function resetTestState() {
            logTest('ğŸ”„ é‡ç½®æµ‹è¯•çŠ¶æ€', 'info');
            
            // é‡ç½®æ‰€æœ‰ä»»åŠ¡å¡
            document.querySelectorAll('.task-flip-container').forEach(container => {
                container.classList.remove('flipped');
                
                const taskId = container.getAttribute('data-task-id');
                const badge = container.querySelector('.badge');
                if (badge) {
                    badge.textContent = 'å¾…å¤„ç†';
                    badge.classList.remove('bg-success');
                    badge.classList.add('bg-warning');
                }
                
                const buttons = container.querySelectorAll(`[data-task-id="${taskId}"]`);
                buttons.forEach(button => {
                    button.disabled = false;
                    button.style.opacity = '1';
                    button.style.cursor = 'pointer';
                    if (button.getAttribute('data-action') === 'flip') {
                        button.innerHTML = '<i class="fas fa-truck"></i> å¤„ç†å‘è´§';
                    }
                });
            });
            
            // é‡ç½®æµ‹è¯•çŠ¶æ€
            testState = {
                currentStep: 0,
                totalSteps: 0,
                results: [],
                startTime: null
            };
            
            updateStatus('ready', 'å‡†å¤‡å°±ç»ª');
            logTest('âœ… æµ‹è¯•çŠ¶æ€å·²é‡ç½®', 'success');
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•åºåˆ—ï¼ˆå…³é”®æµ‹è¯•ï¼‰
        async function runFullTestSequence() {
            updateStatus('testing', 'æ­£åœ¨è¿è¡Œæµ‹è¯•åºåˆ—');
            logTest('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•åºåˆ—', 'info');
            
            testState.startTime = Date.now();
            testState.totalSteps = 6;
            testState.currentStep = 0;
            
            try {
                // æ­¥éª¤1: åº”ç”¨ä¿®å¤ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (document.getElementById('autoApplyFixes').checked) {
                    logTest('ğŸ”§ åº”ç”¨ç»¼åˆæ€§ä¿®å¤...', 'info');
                    if (typeof applyWarehouseFlipFixes === 'function') {
                        applyWarehouseFlipFixes();
                        logTest('âœ… ä¿®å¤å·²åº”ç”¨', 'success');
                    } else {
                        logTest('âš ï¸  ä¿®å¤å‡½æ•°æœªæ‰¾åˆ°ï¼Œè·³è¿‡æ­¤æ­¥éª¤', 'warning');
                    }
                }
                testState.currentStep++;
                
                // æ­¥éª¤2: æµ‹è¯•ç¬¬ä¸€å¼ å¡ç‰‡ç¿»è½¬
                logTest('ğŸ§ª æ­¥éª¤1: æµ‹è¯•ç¬¬ä¸€å¼ å¡ç‰‡ç¿»è½¬', 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                const flip1Success = simulateToggleTaskCardFlip('TASK001');
                await new Promise(resolve => setTimeout(resolve, 500));
                if (flip1Success) {
                    logTest('âœ… ç¬¬ä¸€å¼ å¡ç‰‡ç¿»è½¬æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    throw new Error('ç¬¬ä¸€å¼ å¡ç‰‡ç¿»è½¬å¤±è´¥');
                }
                testState.currentStep++;
                
                // æ­¥éª¤3: æµ‹è¯•ç¬¬ä¸€å¼ å¡ç‰‡è¿”å›
                logTest('ğŸ§ª æ­¥éª¤2: æµ‹è¯•ç¬¬ä¸€å¼ å¡ç‰‡è¿”å›', 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                const return1Success = simulateToggleTaskCardFlip('TASK001');
                await new Promise(resolve => setTimeout(resolve, 500));
                if (return1Success) {
                    logTest('âœ… ç¬¬ä¸€å¼ å¡ç‰‡è¿”å›æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    throw new Error('ç¬¬ä¸€å¼ å¡ç‰‡è¿”å›å¤±è´¥');
                }
                testState.currentStep++;
                
                // æ­¥éª¤4: æ¨¡æ‹Ÿç¬¬ä¸€å¼ å¡ç‰‡å‘è´§å®Œæˆ
                logTest('ğŸ§ª æ­¥éª¤3: æ¨¡æ‹Ÿç¬¬ä¸€å¼ å¡ç‰‡å‘è´§å®Œæˆ', 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                const ship1Success = simulateCompleteShipment('TASK001');
                await new Promise(resolve => setTimeout(resolve, 1000));
                if (ship1Success) {
                    logTest('âœ… ç¬¬ä¸€å¼ å¡ç‰‡å‘è´§å®Œæˆæ¨¡æ‹ŸæˆåŠŸ', 'success');
                } else {
                    throw new Error('ç¬¬ä¸€å¼ å¡ç‰‡å‘è´§æ¨¡æ‹Ÿå¤±è´¥');
                }
                testState.currentStep++;
                
                // æ­¥éª¤5: å…³é”®æµ‹è¯• - ç¬¬äºŒå¼ å¡ç‰‡ç¿»è½¬ï¼ˆåŸå§‹é—®é¢˜ç‚¹ï¼‰
                logTest('ğŸ§ª æ­¥éª¤4: å…³é”®æµ‹è¯• - ç¬¬äºŒå¼ å¡ç‰‡ç¿»è½¬ï¼ˆåŸå§‹é—®é¢˜ç‚¹ï¼‰', 'warning');
                await new Promise(resolve => setTimeout(resolve, 500));
                const flip2Success = simulateToggleTaskCardFlip('TASK002');
                await new Promise(resolve => setTimeout(resolve, 500));
                if (flip2Success) {
                    logTest('ğŸ‰ ç¬¬äºŒå¼ å¡ç‰‡ç¿»è½¬æµ‹è¯•é€šè¿‡ï¼é—®é¢˜å·²ä¿®å¤ï¼', 'success');
                } else {
                    throw new Error('ç¬¬äºŒå¼ å¡ç‰‡ç¿»è½¬å¤±è´¥ - é—®é¢˜ä»ç„¶å­˜åœ¨');
                }
                testState.currentStep++;
                
                // æ­¥éª¤6: æµ‹è¯•ç¬¬äºŒå¼ å¡ç‰‡è¿”å›
                logTest('ğŸ§ª æ­¥éª¤5: æµ‹è¯•ç¬¬äºŒå¼ å¡ç‰‡è¿”å›', 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                const return2Success = simulateToggleTaskCardFlip('TASK002');
                await new Promise(resolve => setTimeout(resolve, 500));
                if (return2Success) {
                    logTest('âœ… ç¬¬äºŒå¼ å¡ç‰‡è¿”å›æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    throw new Error('ç¬¬äºŒå¼ å¡ç‰‡è¿”å›å¤±è´¥');
                }
                testState.currentStep++;
                
                // æµ‹è¯•å®Œæˆ
                const duration = Date.now() - testState.startTime;
                logTest(`ğŸ† æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼è€—æ—¶: ${duration}ms`, 'success');
                updateStatus('success', `æµ‹è¯•å®Œæˆ (${duration}ms)`);
                
            } catch (error) {
                logTest(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('error', 'æµ‹è¯•å¤±è´¥');
            }
        }

        // åˆ†æ­¥æµ‹è¯•
        async function runIndividualTests() {
            logTest('ğŸ“‹ å¼€å§‹åˆ†æ­¥æµ‹è¯•æ¨¡å¼', 'info');
            
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´è¯¦ç»†çš„åˆ†æ­¥æµ‹è¯•é€‰é¡¹
            const testOptions = [
                { name: 'çŠ¶æ€ç®¡ç†æµ‹è¯•', action: testStateManager },
                { name: 'å…ƒç´ æŸ¥æ‰¾æµ‹è¯•', action: testElementFinder },
                { name: 'äº‹ä»¶ç»‘å®šæµ‹è¯•', action: testEventBinding },
                { name: 'é˜²æŠ–æœºåˆ¶æµ‹è¯•', action: testDebounce }
            ];
            
            testOptions.forEach((test, index) => {
                setTimeout(() => {
                    logTest(`ğŸ§ª è¿è¡Œæµ‹è¯•: ${test.name}`, 'info');
                    if (typeof test.action === 'function') {
                        test.action();
                    }
                }, index * 1000);
            });
        }

        // å„ç§æµ‹è¯•å‡½æ•°
        function testStateManager() {
            logTest('ğŸ”§ æµ‹è¯•çŠ¶æ€ç®¡ç†æœºåˆ¶...', 'info');
            if (typeof flipCooldown !== 'undefined') {
                logTest(`âœ… é˜²æŠ–Mapå­˜åœ¨ï¼Œå¤§å°: ${flipCooldown.size}`, 'success');
            } else {
                logTest('âŒ é˜²æŠ–Mapä¸å­˜åœ¨', 'error');
            }
        }

        function testElementFinder() {
            logTest('ğŸ” æµ‹è¯•å…ƒç´ æŸ¥æ‰¾æœºåˆ¶...', 'info');
            const containers = document.querySelectorAll('.task-flip-container');
            logTest(`âœ… æ‰¾åˆ° ${containers.length} ä¸ªä»»åŠ¡å®¹å™¨`, 'success');
            
            containers.forEach((container, index) => {
                const taskId = container.getAttribute('data-task-id');
                const front = container.querySelector('.task-front');
                const back = container.querySelector('.task-back');
                logTest(`  å®¹å™¨${index + 1} (${taskId}): æœ‰æ­£é¢=${!!front}, æœ‰èƒŒé¢=${!!back}`, 'info');
            });
        }

        function testEventBinding() {
            logTest('ğŸ”— æµ‹è¯•äº‹ä»¶ç»‘å®šçŠ¶æ€...', 'info');
            const buttons = document.querySelectorAll('[data-action="flip"]');
            logTest(`âœ… æ‰¾åˆ° ${buttons.length} ä¸ªç¿»è½¬æŒ‰é’®`, 'success');
            
            buttons.forEach((button, index) => {
                const taskId = button.getAttribute('data-task-id');
                const disabled = button.disabled;
                logTest(`  æŒ‰é’®${index + 1} (${taskId}): ç¦ç”¨=${disabled}`, 'info');
            });
        }

        function testDebounce() {
            logTest('â±ï¸  æµ‹è¯•é˜²æŠ–æœºåˆ¶...', 'info');
            // æ¨¡æ‹Ÿå¿«é€Ÿç‚¹å‡»æµ‹è¯•
            const taskId = 'TASK001';
            let successCount = 0;
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    if (typeof toggleTaskCardFlip === 'function') {
                        toggleTaskCardFlip(taskId);
                        successCount++;
                    }
                }, i * 100);
            }
            
            setTimeout(() => {
                logTest(`âœ… é˜²æŠ–æµ‹è¯•å®Œæˆï¼Œæ‰§è¡Œæ¬¡æ•°: ${successCount}/5`, 'success');
            }, 1000);
        }

        // é‡ç½®æ‰€æœ‰æµ‹è¯•
        function resetAllTests() {
            resetTestState();
            clearTestLog();
            logTest('ğŸ”„ æ‰€æœ‰æµ‹è¯•å·²é‡ç½®', 'info');
        }

        // æ¸…ç©ºæµ‹è¯•æ—¥å¿—
        function clearTestLog() {
            document.getElementById('testLog').innerHTML = '<div class="text-muted">æµ‹è¯•æ—¥å¿—å·²æ¸…ç©º...</div>';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logTest('ğŸš€ ä»“åº“å‘è´§ä»»åŠ¡å¡ç¿»è½¬ä¿®å¤éªŒè¯å·¥å…·å·²å¯åŠ¨', 'success');
            logTest('ğŸ’¡ ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•åºåˆ—"å¼€å§‹å…³é”®æµ‹è¯•', 'info');
            logTest('ğŸ’¡ è¯¥æµ‹è¯•å°†éªŒè¯å‘è´§åç¬¬äºŒå¼ å¡ç‰‡çš„ç¿»è½¬åŠŸèƒ½', 'info');
            
            // å¦‚æœå¯ç”¨äº†è‡ªåŠ¨æ¢å¤ï¼Œå¯åŠ¨ç›‘æ§
            if (document.getElementById('enableAutoRecovery').checked) {
                setInterval(() => {
                    // å®šæœŸæ£€æŸ¥å’Œæ¢å¤
                    const containers = document.querySelectorAll('.task-flip-container');
                    containers.forEach(container => {
                        const taskId = container.getAttribute('data-task-id');
                        if (taskId && typeof taskFlipStates !== 'undefined') {
                            const expectedState = taskFlipStates.get(taskId) || false;
                            const actualState = container.classList.contains('flipped');
                            if (expectedState !== actualState) {
                                logTest(`ğŸ”§ è‡ªåŠ¨ä¿®å¤ä»»åŠ¡ ${taskId} çŠ¶æ€ä¸ä¸€è‡´`, 'warning');
                                container.classList.toggle('flipped', expectedState);
                            }
                        }
                    });
                }, 3000);
            }
        });
    </script>
</body>
</html>