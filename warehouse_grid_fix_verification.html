<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»“åº“ä»»åŠ¡å¡ç½‘æ ¼å¸ƒå±€ä¿®å¤éªŒè¯</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .verification-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #4361ee;
            border-bottom: 2px solid #4361ee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #4cc9f0; }
        .status-error { background-color: #ef233c; }
        .status-warning { background-color: #f72585; }
        
        /* æ¨¡æ‹ŸåŸå§‹çš„.task-galleryæ ·å¼ */
        .task-gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        /* æ¨¡æ‹Ÿä»“åº“ä»»åŠ¡å®¹å™¨æ ·å¼ */
        .task-flip-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .task-flip-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        
        .task-gallery-img {
            width: 100%;
            height: 140px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .task-info-container {
            text-align: center;
        }
        
        .task-gallery-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 6px;
            color: #333;
        }
        
        .task-gallery-code {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
        }
        
        .task-gallery-qty {
            font-size: 0.85rem;
            color: #4361ee;
            font-weight: 600;
        }
        
        /* é—®é¢˜æ¼”ç¤ºåŒºåŸŸ */
        .problem-demo {
            background: #fff5f5;
            border: 2px dashed #ef233c;
        }
        
        .fixed-demo {
            background: #f0fff4;
            border: 2px solid #4cc9f0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">ğŸ“¦ ä»“åº“ä»»åŠ¡å¡ç½‘æ ¼å¸ƒå±€ä¿®å¤éªŒè¯</h1>
        
        <!-- è¯Šæ–­ä¿¡æ¯åŒºåŸŸ -->
        <div class="verification-section">
            <h3 class="section-title">ğŸ“‹ ç³»ç»Ÿè¯Šæ–­ä¿¡æ¯</h3>
            <div id="diagnosticInfo">
                <p><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æ£€æµ‹ç³»ç»ŸçŠ¶æ€...</p>
            </div>
        </div>
        
        <!-- é—®é¢˜æ¼”ç¤ºåŒºåŸŸ -->
        <div class="verification-section">
            <h3 class="section-title">âŒ å½“å‰é—®é¢˜æ¼”ç¤ºï¼ˆå‚ç›´å †å ï¼‰</h3>
            <div class="problem-demo">
                <div class="task-gallery warehouse-tasks-gallery" id="problemDemo">
                    <!-- è¿™é‡Œä¼šåŠ¨æ€æ’å…¥æœ‰é—®é¢˜çš„å¸ƒå±€ -->
                </div>
            </div>
        </div>
        
        <!-- ä¿®å¤åæ¼”ç¤ºåŒºåŸŸ -->
        <div class="verification-section">
            <h3 class="section-title">âœ… ä¿®å¤åæ•ˆæœæ¼”ç¤ºï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰</h3>
            <div class="fixed-demo">
                <div class="task-gallery warehouse-tasks-gallery" id="fixedDemo">
                    <!-- è¿™é‡Œä¼šåŠ¨æ€æ’å…¥ä¿®å¤åçš„å¸ƒå±€ -->
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="verification-section">
            <h3 class="section-title">ğŸ›ï¸ æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <div class="row">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100 mb-2" onclick="runFullTest()">
                        <i class="fas fa-play"></i> è¿è¡Œå®Œæ•´æµ‹è¯•
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100 mb-2" onclick="applyFix()">
                        <i class="fas fa-wrench"></i> åº”ç”¨ä¿®å¤æ–¹æ¡ˆ
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info w-100 mb-2" onclick="resetTest()">
                        <i class="fas fa-redo"></i> é‡ç½®æµ‹è¯•
                    </button>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <button class="btn btn-warning w-100" onclick="toggleDebug()">
                        <i class="fas fa-bug"></i> <span id="debugBtnText">å¯ç”¨è°ƒè¯•æ¨¡å¼</span>
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-secondary w-100" onclick="checkResponsive()">
                        <i class="fas fa-mobile-alt"></i> æµ‹è¯•å“åº”å¼
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœè¾“å‡º -->
        <div class="verification-section">
            <h3 class="section-title">ğŸ“Š æµ‹è¯•ç»“æœè¾“å‡º</h3>
            <div id="testOutput" style="background: #f8f9fa; padding: 15px; border-radius: 5px; min-height: 200px;">
                <p class="text-muted">æµ‹è¯•ç»“æœå°†åœ¨æ­¤å¤„æ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <!-- åŠ è½½ä¿®å¤è„šæœ¬ -->
    <script src="warehouse_task_grid_fix.js"></script>
    
    <script>
        // æµ‹è¯•æ•°æ®
        const mockTasks = [
            {
                id: 'TEST001',
                name: 'æµ‹è¯•å•†å“A',
                code: 'CODE001',
                qty: 3,
                creator: 'æµ‹è¯•ç”¨æˆ·1'
            },
            {
                id: 'TEST002',
                name: 'æµ‹è¯•å•†å“Bè¶…é•¿åç§°æµ‹è¯•',
                code: 'CODE002',
                qty: 1,
                creator: 'æµ‹è¯•ç”¨æˆ·2'
            },
            {
                id: 'TEST003',
                name: 'æµ‹è¯•å•†å“C',
                code: 'CODE003',
                qty: 5,
                creator: 'æµ‹è¯•ç”¨æˆ·3'
            },
            {
                id: 'TEST004',
                name: 'æµ‹è¯•å•†å“D',
                code: 'CODE004',
                qty: 2,
                creator: 'æµ‹è¯•ç”¨æˆ·4'
            },
            {
                id: 'TEST005',
                name: 'æµ‹è¯•å•†å“E',
                code: 'CODE005',
                qty: 7,
                creator: 'æµ‹è¯•ç”¨æˆ·5'
            },
            {
                id: 'TEST006',
                name: 'æµ‹è¯•å•†å“F',
                code: 'CODE006',
                qty: 1,
                creator: 'æµ‹è¯•ç”¨æˆ·6'
            }
        ];

        // ç”Ÿæˆä»»åŠ¡å¡ç‰‡HTML
        function generateTaskCard(task, isProblem = false) {
            return `
                <div class="task-flip-container" data-task-id="${task.id}">
                    <div class="task-front">
                        <div class="task-gallery-img">
                            <i class="fas fa-image fa-2x text-muted"></i>
                        </div>
                        <div class="task-info-container">
                            <div class="task-gallery-name">${task.name}</div>
                            <div class="task-gallery-code">è´§å·: ${task.code}</div>
                            <div class="task-gallery-qty">æ•°é‡: ${task.qty} | ${task.creator}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“é—®é¢˜æ¼”ç¤º
        function renderProblemDemo() {
            const container = document.getElementById('problemDemo');
            container.innerHTML = '';
            
            // æ¨¡æ‹Ÿé—®é¢˜æ ·å¼ - å‚ç›´å †å 
            const problemStyle = document.createElement('style');
            problemStyle.id = 'problem-styles';
            problemStyle.textContent = `
                .problem-demo .task-gallery.warehouse-tasks-gallery {
                    display: block !important;
                }
                .problem-demo .task-flip-container {
                    display: block !important;
                    width: 100% !important;
                    margin-bottom: 10px !important;
                }
            `;
            document.head.appendChild(problemStyle);
            
            // æ·»åŠ æµ‹è¯•ä»»åŠ¡
            mockTasks.slice(0, 4).forEach(task => {
                container.innerHTML += generateTaskCard(task, true);
            });
        }

        // æ¸²æŸ“ä¿®å¤åæ¼”ç¤º
        function renderFixedDemo() {
            const container = document.getElementById('fixedDemo');
            container.innerHTML = '';
            
            // æ·»åŠ æµ‹è¯•ä»»åŠ¡
            mockTasks.forEach(task => {
                container.innerHTML += generateTaskCard(task);
            });
        }

        // ç³»ç»Ÿè¯Šæ–­
        function runDiagnostic() {
            const output = document.getElementById('diagnosticInfo');
            let result = '<div class="row">';
            
            // æ£€æŸ¥åŸºæœ¬å…ƒç´ 
            const hasTaskGallery = !!document.querySelector('.task-gallery');
            const hasWarehouseTasks = !!document.querySelector('.warehouse-tasks-gallery');
            const hasFlipFixScript = !!window.applyFundamentalGridFix;
            
            result += `
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasTaskGallery ? 'status-success' : 'status-error'}"></span> .task-galleryå­˜åœ¨: ${hasTaskGallery ? 'âœ…' : 'âŒ'}</p>
                </div>
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasWarehouseTasks ? 'status-success' : 'status-error'}"></span> .warehouse-tasks-galleryå­˜åœ¨: ${hasWarehouseTasks ? 'âœ…' : 'âŒ'}</p>
                </div>
                <div class="col-md-4">
                    <p><span class="status-indicator ${hasFlipFixScript ? 'status-success' : 'status-error'}"></span> ä¿®å¤è„šæœ¬åŠ è½½: ${hasFlipFixScript ? 'âœ…' : 'âŒ'}</p>
                </div>
            `;
            
            result += '</div>';
            output.innerHTML = result;
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        function runFullTest() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</p>';
            
            setTimeout(() => {
                let result = '<h5>ğŸ æµ‹è¯•ç»“æœæ±‡æ€»:</h5>';
                
                // æµ‹è¯•1: åŸºç¡€å¸ƒå±€æ£€æµ‹
                const gallery = document.querySelector('.task-gallery.warehouse-tasks-gallery');
                const computedStyle = gallery ? window.getComputedStyle(gallery) : null;
                
                result += `<p><strong>1. ç½‘æ ¼å¸ƒå±€æ£€æµ‹:</strong> ${computedStyle && computedStyle.display === 'grid' ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</p>`;
                result += `<p><strong>2. åˆ—æ•°è®¾ç½®:</strong> ${computedStyle ? computedStyle.gridTemplateColumns : 'æœªè®¾ç½®'}</p>`;
                result += `<p><strong>3. é—´è·è®¾ç½®:</strong> ${computedStyle ? computedStyle.gap : 'æœªè®¾ç½®'}</p>`;
                
                // æµ‹è¯•2: ä»»åŠ¡å¡ç‰‡æ•°é‡
                const cards = document.querySelectorAll('.task-flip-container');
                result += `<p><strong>4. ä»»åŠ¡å¡ç‰‡æ•°é‡:</strong> ${cards.length} ä¸ª</p>`;
                
                // æµ‹è¯•3: å“åº”å¼æ£€æµ‹
                result += `<p><strong>5. å“åº”å¼æ”¯æŒ:</strong> å·²é…ç½®åª’ä½“æŸ¥è¯¢</p>`;
                
                output.innerHTML = result;
            }, 1000);
        }

        // åº”ç”¨ä¿®å¤æ–¹æ¡ˆ
        function applyFix() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p><i class="fas fa-cog fa-spin"></i> æ­£åœ¨åº”ç”¨ä¿®å¤æ–¹æ¡ˆ...</p>';
            
            try {
                if (typeof applyFundamentalGridFix === 'function') {
                    applyFundamentalGridFix();
                    setTimeout(() => {
                        output.innerHTML = '<p class="text-success"><i class="fas fa-check-circle"></i> ä¿®å¤æ–¹æ¡ˆå·²æˆåŠŸåº”ç”¨ï¼</p>';
                    }, 500);
                } else {
                    output.innerHTML = '<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> ä¿®å¤å‡½æ•°æœªæ‰¾åˆ°ï¼</p>';
                }
            } catch (error) {
                output.innerHTML = `<p class="text-danger"><i class="fas fa-exclamation-triangle"></i> åº”ç”¨ä¿®å¤æ—¶å‡ºé”™: ${error.message}</p>`;
            }
        }

        // é‡ç½®æµ‹è¯•
        function resetTest() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p class="text-info"><i class="fas fa-sync-alt"></i> æµ‹è¯•ç¯å¢ƒå·²é‡ç½®</p>';
            
            // ç§»é™¤è°ƒè¯•æ ·å¼
            const debugStyle = document.getElementById('debug-styles');
            if (debugStyle) debugStyle.remove();
            
            // é‡æ–°æ¸²æŸ“
            renderProblemDemo();
            renderFixedDemo();
        }

        // è°ƒè¯•æ¨¡å¼åˆ‡æ¢
        function toggleDebug() {
            const debugBtn = document.getElementById('debugBtnText');
            const existingStyle = document.getElementById('debug-styles');
            
            if (existingStyle) {
                existingStyle.remove();
                debugBtn.textContent = 'å¯ç”¨è°ƒè¯•æ¨¡å¼';
            } else {
                const debugStyle = document.createElement('style');
                debugStyle.id = 'debug-styles';
                debugStyle.textContent = `
                    .task-flip-container:nth-child(3n+1) { outline: 2px solid #4361ee !important; }
                    .task-flip-container:nth-child(3n+2) { outline: 2px solid #7209b7 !important; }
                    .task-flip-container:nth-child(3n+3) { outline: 2px solid #f72585 !important; }
                    .task-gallery.warehouse-tasks-gallery { outline: 3px solid #4cc9f0 !important; }
                `;
                document.head.appendChild(debugStyle);
                debugBtn.textContent = 'ç¦ç”¨è°ƒè¯•æ¨¡å¼';
            }
        }

        // å“åº”å¼æµ‹è¯•
        function checkResponsive() {
            const output = document.getElementById('testOutput');
            output.innerHTML = '<p><i class="fas fa-mobile-alt"></i> æ­£åœ¨æ¨¡æ‹Ÿä¸åŒå±å¹•å°ºå¯¸...</p>';
            
            setTimeout(() => {
                const widths = [1400, 1024, 768, 480];
                let result = '<h5>ğŸ“± å“åº”å¼æµ‹è¯•ç»“æœ:</h5>';
                
                widths.forEach(width => {
                    result += `<p>å±å¹•å®½åº¦ ${width}px: ${
                        width >= 1200 ? '3åˆ—å¸ƒå±€' :
                        width >= 768 ? '2åˆ—å¸ƒå±€' : '1åˆ—å¸ƒå±€'
                    }</p>`;
                });
                
                output.innerHTML = result;
            }, 800);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª ä»“åº“ä»»åŠ¡å¡ç½‘æ ¼å¸ƒå±€æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // åˆå§‹åŒ–æ¼”ç¤ºå†…å®¹
            renderProblemDemo();
            renderFixedDemo();
            
            // è¿è¡Œåˆå§‹è¯Šæ–­
            setTimeout(runDiagnostic, 1000);
        });
    </script>
</body>
</html>