<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡å…ƒç´ ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .task-sample {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .log-output {
            background: #2d2d2d;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .status-indicator {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; }
        .warning { background-color: #fff3cd; color: #856404; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">ğŸ”§ ä»»åŠ¡å…ƒç´ ä¿®å¤æµ‹è¯•</h1>
        
        <div class="alert alert-info">
            <h4>ğŸ¯ æµ‹è¯•ç›®æ ‡</h4>
            <p>éªŒè¯ç´§æ€¥ç¿»è½¬åŠŸèƒ½ä¿®å¤è„šæœ¬èƒ½å¦æ­£ç¡®è¯†åˆ«å’Œä¿®å¤ä»»åŠ¡å…ƒç´ </p>
        </div>

        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶é¢æ¿</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="taskIdInput" class="form-label">ä»»åŠ¡ID:</label>
                            <input type="text" class="form-control" id="taskIdInput" value="95" placeholder="è¾“å…¥ä»»åŠ¡ID">
                        </div>
                        <button class="btn btn-primary me-2" onclick="testFixFunction()">
                            <i class="fas fa-wrench me-1"></i>æµ‹è¯•ä¿®å¤åŠŸèƒ½
                        </button>
                        <button class="btn btn-secondary me-2" onclick="runDiagnostics()">
                            <i class="fas fa-search me-1"></i>è¿è¡Œè¯Šæ–­
                        </button>
                        <button class="btn btn-info" onclick="clearLogs()">
                            <i class="fas fa-trash me-1"></i>æ¸…ç©ºæ—¥å¿—
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">å¿«é€Ÿæµ‹è¯•:</label>
                            <div>
                                <button class="btn btn-outline-primary btn-sm me-1" onclick="setTaskId('95')">ä»»åŠ¡95</button>
                                <button class="btn btn-outline-primary btn-sm me-1" onclick="setTaskId('1')">ä»»åŠ¡1</button>
                                <button class="btn btn-outline-primary btn-sm me-1" onclick="setTaskId('100')">ä»»åŠ¡100</button>
                            </div>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="autoRunCheckbox">
                            <label class="form-check-label" for="autoRunCheckbox">
                                é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡Œè¯Šæ–­
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
        <div id="statusIndicator" class="status-indicator info">
            ğŸ’¡ å‡†å¤‡å°±ç»ª - è¾“å…¥ä»»åŠ¡IDå¹¶ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹
        </div>

        <!-- æµ‹è¯•æ ·æœ¬åŒºåŸŸ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>ğŸ“‹ æµ‹è¯•æ ·æœ¬åŒºåŸŸ</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="task-sample">
                            <h6>æ ·æœ¬1: æ ‡å‡†ä»»åŠ¡å¡ç‰‡</h6>
                            <div id="task-95" class="task-card" data-task-id="95">
                                <div class="task-front" id="task-95-front" data-task-id="95">
                                    <h6>ä»»åŠ¡ #95</h6>
                                    <p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ä»»åŠ¡å¡ç‰‡ç¤ºä¾‹</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="task-sample">
                            <h6>æ ·æœ¬2: ç®€åŒ–ä»»åŠ¡å¡ç‰‡</h6>
                            <div id="task-1" data-task-id="1">
                                <h6>ä»»åŠ¡ #1</h6>
                                <p>è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ä»»åŠ¡å¡ç‰‡ç¤ºä¾‹</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="task-sample">
                            <h6>æ ·æœ¬3: å®¹å™¨å¼ä»»åŠ¡å¡ç‰‡</h6>
                            <div class="task-container" data-task-id="100">
                                <div class="task-front">
                                    <h6>ä»»åŠ¡ #100</h6>
                                    <p>è¿™æ˜¯å®¹å™¨å¼çš„ä»»åŠ¡å¡ç‰‡ç¤ºä¾‹</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="task-sample">
                            <h6>æ ·æœ¬4: æ— IDä»»åŠ¡å¡ç‰‡</h6>
                            <div class="task-item">
                                <div class="task-front">
                                    <h6>æœªæŒ‡å®šIDçš„ä»»åŠ¡</h6>
                                    <p>è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰æ˜ç¡®IDçš„ä»»åŠ¡å¡ç‰‡</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ—¥å¿—è¾“å‡º -->
        <div class="card">
            <div class="card-header">
                <h5>ğŸ“ æ‰§è¡Œæ—¥å¿—</h5>
            </div>
            <div class="card-body">
                <div id="logOutput" class="log-output">
                    ç­‰å¾…æ‰§è¡Œæµ‹è¯•...
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ä¿®å¤è„šæœ¬ -->
    <script src="emergency_flip_fix.js"></script>
    <script src="debug_task_elements.js"></script>

    <script>
        // æ—¥å¿—è®°å½•æ‹¦æˆª
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const logOutput = document.getElementById('logOutput');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? 'âŒ' : type === 'warn' ? 'âš ï¸' : 'â„¹ï¸';
            const logEntry = `<div>[${timestamp}] ${typeIcon} ${message}</div>`;
            
            logOutput.innerHTML += logEntry;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };
        
        // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
        function updateStatus(message, type = 'info') {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator ${type}`;
            indicator.innerHTML = message;
        }
        
        // è®¾ç½®ä»»åŠ¡ID
        function setTaskId(taskId) {
            document.getElementById('taskIdInput').value = taskId;
        }
        
        // æµ‹è¯•ä¿®å¤åŠŸèƒ½
        function testFixFunction() {
            const taskId = document.getElementById('taskIdInput').value;
            if (!taskId) {
                updateStatus('âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ä»»åŠ¡ID', 'error');
                return;
            }
            
            updateStatus('ğŸ”§ æ­£åœ¨æµ‹è¯•ä¿®å¤åŠŸèƒ½...', 'warning');
            addToLog(`å¼€å§‹æµ‹è¯•ä»»åŠ¡ ${taskId} çš„ä¿®å¤åŠŸèƒ½...`);
            
            try {
                if (typeof window.fixSpecificTaskCard === 'function') {
                    const result = window.fixSpecificTaskCard(taskId);
                    if (result) {
                        updateStatus(`âœ… ä»»åŠ¡ ${taskId} ä¿®å¤æˆåŠŸ!`, 'success');
                        addToLog(`ä»»åŠ¡ ${taskId} ä¿®å¤å®Œæˆ`);
                    } else {
                        updateStatus(`âŒ ä»»åŠ¡ ${taskId} ä¿®å¤å¤±è´¥`, 'error');
                        addToLog(`ä»»åŠ¡ ${taskId} ä¿®å¤å¤±è´¥`);
                    }
                } else {
                    updateStatus('âŒ ä¿®å¤å‡½æ•°ä¸å¯ç”¨', 'error');
                    addToLog('é”™è¯¯: fixSpecificTaskCard å‡½æ•°æœªå®šä¹‰');
                }
            } catch (error) {
                updateStatus('âŒ æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', 'error');
                addToLog(`æ‰§è¡Œé”™è¯¯: ${error.message}`);
                console.error('æµ‹è¯•æ‰§è¡Œé”™è¯¯:', error);
            }
        }
        
        // è¿è¡Œè¯Šæ–­
        function runDiagnostics() {
            updateStatus('ğŸ” æ­£åœ¨è¿è¡Œè¯Šæ–­...', 'warning');
            addToLog('å¼€å§‹è¿è¡Œä»»åŠ¡å…ƒç´ è¯Šæ–­...');
            
            try {
                if (typeof window.diagnoseCurrentTasks === 'function') {
                    window.diagnoseCurrentTasks();
                    updateStatus('âœ… è¯Šæ–­å®Œæˆ', 'success');
                } else {
                    addToLog('è¯Šæ–­å‡½æ•°ä¸å¯ç”¨ï¼Œå°è¯•æ‰‹åŠ¨è¯Šæ–­...');
                    // æ‰‹åŠ¨æ‰§è¡Œè¯Šæ–­é€»è¾‘
                    manualDiagnosis();
                }
            } catch (error) {
                updateStatus('âŒ è¯Šæ–­è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', 'error');
                addToLog(`è¯Šæ–­é”™è¯¯: ${error.message}`);
            }
        }
        
        // æ‰‹åŠ¨è¯Šæ–­å‡½æ•°
        function manualDiagnosis() {
            console.log('ğŸ” æ‰‹åŠ¨è¯Šæ–­å¼€å§‹...');
            
            // æ£€æŸ¥å„ç§å…ƒç´ 
            const taskFronts = document.querySelectorAll('.task-front');
            const taskContainers = document.querySelectorAll('[data-task-id]');
            const allTasks = document.querySelectorAll('[id*="task"]');
            
            console.log(`ğŸ“Š è¯Šæ–­ç»“æœ:`);
            console.log(`   - .task-front å…ƒç´ : ${taskFronts.length} ä¸ª`);
            console.log(`   - data-task-id å…ƒç´ : ${taskContainers.length} ä¸ª`);
            console.log(`   - IDåŒ…å«taskçš„å…ƒç´ : ${allTasks.length} ä¸ª`);
            
            // æ£€æŸ¥ä¿®å¤å‡½æ•°
            console.log(`âš¡ å‡½æ•°æ£€æŸ¥:`);
            console.log(`   - fixSpecificTaskCard: ${typeof window.fixSpecificTaskCard === 'function' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}`);
            console.log(`   - performEmergencyFlipFix: ${typeof window.performEmergencyFlipFix === 'function' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}`);
            
            updateStatus('âœ… æ‰‹åŠ¨è¯Šæ–­å®Œæˆ', 'success');
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLogs() {
            logOutput.innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...';
            updateStatus('ğŸ’¡ æ—¥å¿—å·²æ¸…ç©º', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ä»»åŠ¡å…ƒç´ ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            updateStatus('âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•', 'success');
            
            // æ£€æŸ¥æ˜¯å¦è‡ªåŠ¨è¿è¡Œè¯Šæ–­
            const autoRun = document.getElementById('autoRunCheckbox');
            if (autoRun.checked) {
                setTimeout(runDiagnostics, 1000);
            }
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 'Enter':
                        event.preventDefault();
                        testFixFunction();
                        break;
                    case 'd':
                        event.preventDefault();
                        runDiagnostics();
                        break;
                    case 'l':
                        event.preventDefault();
                        clearLogs();
                        break;
                }
            }
        });
    </script>
</body>
</html>