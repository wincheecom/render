<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«‹å³ç¿»è½¬åŠŸèƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="immediate_flip_fix.js"></script>
    <style>
        .test-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .result-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">âš¡ ç«‹å³ç¿»è½¬åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ® æ§åˆ¶é¢æ¿</h3>
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-primary" onclick="executeTest()">
                    <i class="fas fa-play me-1"></i>æ‰§è¡Œå®Œæ•´æµ‹è¯•
                </button>
                <button class="btn btn-success" onclick="testTask96Flip()">
                    <i class="fas fa-sync me-1"></i>æµ‹è¯•ä»»åŠ¡#96ç¿»è½¬
                </button>
                <button class="btn btn-info" onclick="diagnoseCurrentState()">
                    <i class="fas fa-stethoscope me-1"></i>è¯Šæ–­å½“å‰çŠ¶æ€
                </button>
                <button class="btn btn-warning" onclick="resetAll()">
                    <i class="fas fa-undo me-1"></i>é‡ç½®æ‰€æœ‰çŠ¶æ€
                </button>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœ -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>
        
        <!-- ä»»åŠ¡å¡ç‰‡å±•ç¤ºåŒº -->
        <div class="test-section">
            <h3>ğŸ“‹ ä»»åŠ¡å¡ç‰‡å±•ç¤º</h3>
            <div class="published-tasks-gallery" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(282.66px, 1fr)); gap: 15px; margin-top: 15px;">
                <!-- ä»»åŠ¡å¡ç‰‡ 96 - ç«‹ä½“æ‹¼å›¾äº¤é€š -->
                <div class="task-flip-container" data-task-id="96">
                    <div class="task-front" id="task-96-front" data-task-id="96">
                        <div class="task-gallery-img" style="width: 262.66px; height: 259.06px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; background-color: rgb(248, 249, 250); display: flex; align-items: center; justify-content: center; min-height: 259.06px; max-height: 259.06px;" data-original-style="width: 262.66px; height: 259.06px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; background-color: rgb(248, 249, 250); display: flex; align-items: center; justify-content: center;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-car fa-2x text-primary"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge badge-warning" style="padding: 2px 6px; font-size: 0.7rem; min-width: 40px; text-align: center;">
                                    å¾…å‘
                                </span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">ç«‹ä½“æ‹¼å›¾äº¤é€š</div>
                                <div class="task-gallery-qty" data-content="1" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 1</div>
                                <div class="task-gallery-creator" data-content="ç®¡ç†å‘˜" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back">
                        <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
                            <div>
                                <h5 style="margin-bottom: 15px; color: #495057;">ğŸ“¦ ä»»åŠ¡æ–‡ä»¶æ¸…å•</h5>
                                <div class="task-files-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-barcode fa-2x mb-2" style="color: #0d6efd;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">æœ¬ä½“ç </div>
                                        <div style="font-size: 11px; color: #6c757d;">ä¸»äº§å“æ ‡è¯†</div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-qrcode fa-2x mb-2" style="color: #198754;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">æ¡ç </div>
                                        <div style="font-size: 11px; color: #6c757d;">ç‰©æµè¿½è¸ªç </div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-exclamation-triangle fa-2x mb-2" style="color: #ffc107;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">è­¦ç¤ºç </div>
                                        <div style="font-size: 11px; color: #6c757d;">å®‰å…¨æé†’</div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-box-open fa-2x mb-2" style="color: #dc3545;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">ç®±å”›</div>
                                        <div style="font-size: 11px; color: #6c757d;">åŒ…è£…æ ‡è¯†</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <i class="fas fa-book fa-2x mb-2" style="color: #6f42c1;"></i>
                                    <div style="font-size: 12px; font-weight: bold;">è¯´æ˜ä¹¦</div>
                                    <div style="font-size: 11px; color: #6c757d;">äº§å“ä½¿ç”¨æŒ‡å—</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-outline-secondary btn-sm" onclick="window.toggleTaskCardFlip('96')" style="flex: 1;">
                                    <i class="fas fa-arrow-left me-1"></i>è¿”å›
                                </button>
                                <button class="btn btn-success btn-sm" style="flex: 1;">
                                    <i class="fas fa-paper-plane me-1"></i>ç¡®è®¤å‘è´§
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡å¡ç‰‡ 97 - ç¤ºä¾‹ä»»åŠ¡ -->
                <div class="task-flip-container" data-task-id="97">
                    <div class="task-front" id="task-97-front" data-task-id="97">
                        <div class="task-gallery-img" style="width: 262.66px; height: 259.06px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; background-color: rgb(248, 249, 250); display: flex; align-items: center; justify-content: center; min-height: 259.06px; max-height: 259.06px;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-cube fa-2x text-success"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge bg-primary">å¤„ç†ä¸­</span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">ç§¯æœ¨ç©å…·ç³»åˆ—</div>
                                <div class="task-gallery-qty" data-content="2" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 2</div>
                                <div class="task-gallery-creator" data-content="é”€å”®å‘˜A" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: é”€å”®å‘˜A</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back">
                        <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
                            <div>
                                <h5 style="margin-bottom: 15px; color: #495057;">ğŸ“¦ ä»»åŠ¡æ–‡ä»¶æ¸…å•</h5>
                                <div class="task-files-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;">
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-barcode fa-2x mb-2" style="color: #0d6efd;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">æœ¬ä½“ç </div>
                                        <div style="font-size: 11px; color: #6c757d;">ä¸»äº§å“æ ‡è¯†</div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-qrcode fa-2x mb-2" style="color: #198754;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">æ¡ç </div>
                                        <div style="font-size: 11px; color: #6c757d;">ç‰©æµè¿½è¸ªç </div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-exclamation-triangle fa-2x mb-2" style="color: #ffc107;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">è­¦ç¤ºç </div>
                                        <div style="font-size: 11px; color: #6c757d;">å®‰å…¨æé†’</div>
                                    </div>
                                    <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <i class="fas fa-box-open fa-2x mb-2" style="color: #dc3545;"></i>
                                        <div style="font-size: 12px; font-weight: bold;">ç®±å”›</div>
                                        <div style="font-size: 11px; color: #6c757d;">åŒ…è£…æ ‡è¯†</div>
                                    </div>
                                </div>
                                <div style="background: white; border-radius: 8px; padding: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <i class="fas fa-book fa-2x mb-2" style="color: #6f42c1;"></i>
                                    <div style="font-size: 12px; font-weight: bold;">è¯´æ˜ä¹¦</div>
                                    <div style="font-size: 11px; color: #6c757d;">äº§å“ä½¿ç”¨æŒ‡å—</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-outline-secondary btn-sm" onclick="window.toggleTaskCardFlip('97')" style="flex: 1;">
                                    <i class="fas fa-arrow-left me-1"></i>è¿”å›
                                </button>
                                <button class="btn btn-success btn-sm" style="flex: 1;">
                                    <i class="fas fa-paper-plane me-1"></i>ç¡®è®¤å‘è´§
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];
        
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultItem = document.createElement('div');
            resultItem.className = `result-item result-${type}`;
            resultItem.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            resultsDiv.appendChild(resultItem);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function executeTest() {
            addTestResult('ğŸš€ å¼€å§‹æ‰§è¡Œå®Œæ•´ç¿»è½¬åŠŸèƒ½æµ‹è¯•...', 'info');
            
            // æµ‹è¯•1: æ£€æŸ¥åŸºç¡€ç¯å¢ƒ
            setTimeout(() => {
                const hasStyles = !!document.getElementById('immediate-flip-fix-styles');
                const hasFunction = typeof window.toggleTaskCardFlip === 'function';
                
                if (hasStyles) {
                    addTestResult('âœ… ç¿»è½¬æ ·å¼å·²åŠ è½½', 'success');
                } else {
                    addTestResult('âŒ ç¿»è½¬æ ·å¼ç¼ºå¤±', 'error');
                }
                
                if (hasFunction) {
                    addTestResult('âœ… ç¿»è½¬å‡½æ•°å¯ç”¨', 'success');
                } else {
                    addTestResult('âŒ ç¿»è½¬å‡½æ•°ä¸å¯ç”¨', 'error');
                }
            }, 500);
            
            // æµ‹è¯•2: æ£€æŸ¥ä»»åŠ¡å¡ç‰‡ç»“æ„
            setTimeout(() => {
                const containers = document.querySelectorAll('.task-flip-container');
                const fronts = document.querySelectorAll('.task-front');
                const backs = document.querySelectorAll('.task-back');
                
                addTestResult(`ğŸ“Š ç»“æ„ç»Ÿè®¡: ${containers.length}ä¸ªå®¹å™¨, ${fronts.length}ä¸ªæ­£é¢, ${backs.length}ä¸ªèƒŒé¢`, 'info');
                
                if (containers.length > 0 && fronts.length > 0 && backs.length > 0) {
                    addTestResult('âœ… ä»»åŠ¡å¡ç‰‡ç»“æ„å®Œæ•´', 'success');
                } else {
                    addTestResult('âŒ ä»»åŠ¡å¡ç‰‡ç»“æ„ä¸å®Œæ•´', 'error');
                }
            }, 1000);
            
            // æµ‹è¯•3: æ‰§è¡Œç¿»è½¬æµ‹è¯•
            setTimeout(() => {
                const task96Container = document.querySelector('.task-flip-container[data-task-id="96"]');
                if (task96Container) {
                    addTestResult('ğŸ”„ å¼€å§‹æµ‹è¯•ä»»åŠ¡#96ç¿»è½¬...', 'info');
                    window.toggleTaskCardFlip('96');
                    
                    setTimeout(() => {
                        const isFlipped = task96Container.classList.contains('flipped');
                        if (isFlipped) {
                            addTestResult('âœ… ä»»åŠ¡#96ç¿»è½¬æˆåŠŸ - ç°åœ¨æ˜¾ç¤ºèƒŒé¢', 'success');
                            
                            // å†æ¬¡ç¿»è½¬å›æ¥
                            setTimeout(() => {
                                window.toggleTaskCardFlip('96');
                                setTimeout(() => {
                                    const isBack = task96Container.classList.contains('flipped');
                                    if (!isBack) {
                                        addTestResult('âœ… ä»»åŠ¡#96ç¿»è½¬å›æ­£é¢æˆåŠŸ', 'success');
                                        addTestResult('ğŸ‰ å®Œæ•´ç¿»è½¬åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼', 'success');
                                    }
                                }, 600);
                            }, 1000);
                        } else {
                            addTestResult('âŒ ä»»åŠ¡#96ç¿»è½¬å¤±è´¥', 'error');
                        }
                    }, 600);
                } else {
                    addTestResult('âŒ æœªæ‰¾åˆ°ä»»åŠ¡#96å®¹å™¨', 'error');
                }
            }, 1500);
        }
        
        function testTask96Flip() {
            addTestResult('ğŸ”„ æ‰‹åŠ¨æµ‹è¯•ä»»åŠ¡#96ç¿»è½¬...', 'info');
            if (typeof window.testTask96Flip === 'function') {
                window.testTask96Flip();
            } else if (typeof window.toggleTaskCardFlip === 'function') {
                window.toggleTaskCardFlip('96');
            } else {
                addTestResult('âŒ ç¿»è½¬åŠŸèƒ½ä¸å¯ç”¨', 'error');
            }
        }
        
        function diagnoseCurrentState() {
            addTestResult('ğŸ” è¯Šæ–­å½“å‰çŠ¶æ€...', 'info');
            
            // æ£€æŸ¥å„ç§å…ƒç´ 
            const containers = document.querySelectorAll('.task-flip-container');
            const flippedContainers = document.querySelectorAll('.task-flip-container.flipped');
            const styles = document.getElementById('immediate-flip-fix-styles');
            const flipFunction = typeof window.toggleTaskCardFlip === 'function';
            
            addTestResult(`ğŸ“Š å½“å‰çŠ¶æ€è¯Šæ–­:`, 'info');
            addTestResult(`   - ç¿»è½¬å®¹å™¨æ€»æ•°: ${containers.length}`, 'info');
            addTestResult(`   - å·²ç¿»è½¬å®¹å™¨æ•°: ${flippedContainers.length}`, 'info');
            addTestResult(`   - æ ·å¼è¡¨åŠ è½½: ${styles ? 'âœ…' : 'âŒ'}`, styles ? 'success' : 'error');
            addTestResult(`   - ç¿»è½¬å‡½æ•°å¯ç”¨: ${flipFunction ? 'âœ…' : 'âŒ'}`, flipFunction ? 'success' : 'error');
            
            // æ£€æŸ¥å…·ä½“ä»»åŠ¡çŠ¶æ€
            const task96 = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (task96) {
                const isFlipped = task96.classList.contains('flipped');
                addTestResult(`   - ä»»åŠ¡#96çŠ¶æ€: ${isFlipped ? 'èƒŒé¢' : 'æ­£é¢'}`, 'info');
            }
        }
        
        function resetAll() {
            addTestResult('â†©ï¸ é‡ç½®æ‰€æœ‰ç¿»è½¬çŠ¶æ€...', 'info');
            
            const containers = document.querySelectorAll('.task-flip-container');
            containers.forEach(container => {
                container.classList.remove('flipped');
            });
            
            addTestResult('âœ… æ‰€æœ‰å¡ç‰‡å·²é‡ç½®åˆ°æ­£é¢', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡è¯Šæ–­
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                addTestResult('ç›‘å¬é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•...', 'info');
                diagnoseCurrentState();
            }, 2000);
        });
    </script>
</body>
</html>