<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡å¡ç‰‡ç¿»è½¬åŠŸèƒ½è¯Šæ–­æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .diagnosis-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        
        .task-flip-container {
            perspective: 1500px;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            width: 300px;
            height: 320px;
            margin: 20px auto;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .task-front, .task-back {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .task-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            z-index: 2;
        }
        
        .task-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
            z-index: 1;
        }
        
        .task-flip-container.flipped {
            transform: rotateY(180deg);
        }
        
        .test-card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">ğŸ” ä»»åŠ¡å¡ç‰‡ç¿»è½¬åŠŸèƒ½è¯Šæ–­æµ‹è¯•</h1>
        
        <!-- è¯Šæ–­ç»“æœæ˜¾ç¤ºåŒº -->
        <div id="diagnosisResults" class="mb-4">
            <h3>è¯Šæ–­ç»“æœ</h3>
            <div id="resultsContainer"></div>
        </div>
        
        <!-- æµ‹è¯•å¡ç‰‡ -->
        <div class="test-card">
            <h4>æµ‹è¯•å¡ç‰‡ #96</h4>
            <div class="task-flip-container" data-task-id="96" id="test-container-96">
                <div class="task-front" id="task-96-front" data-task-id="96">
                    <h5>ä»»åŠ¡å¡ç‰‡æ­£é¢</h5>
                    <p>è¿™æ˜¯ä»»åŠ¡ #96 çš„æ­£é¢å†…å®¹</p>
                    <button class="btn btn-light" onclick="toggleTaskCardFlip('96')">
                        <i class="fas fa-sync-alt"></i> ç¿»è½¬æµ‹è¯•
                    </button>
                </div>
                <div class="task-back" data-task-id="96">
                    <h5>ä»»åŠ¡å¡ç‰‡èƒŒé¢</h5>
                    <p>è¿™æ˜¯ä»»åŠ¡ #96 çš„èƒŒé¢å†…å®¹</p>
                    <button class="btn btn-light" onclick="toggleTaskCardFlip('96')">
                        <i class="fas fa-arrow-left"></i> è¿”å›
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="test-card">
            <h4>è¯Šæ–­æ§åˆ¶é¢æ¿</h4>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary me-2 mb-2" onclick="runFullDiagnosis()">
                        <i class="fas fa-stethoscope"></i> è¿è¡Œå®Œæ•´è¯Šæ–­
                    </button>
                    <button class="btn btn-success me-2 mb-2" onclick="testFlipFunction()">
                        <i class="fas fa-play"></i> æµ‹è¯•ç¿»è½¬åŠŸèƒ½
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-warning me-2 mb-2" onclick="resetTest()">
                        <i class="fas fa-redo"></i> é‡ç½®æµ‹è¯•
                    </button>
                    <button class="btn btn-info me-2 mb-2" onclick="showConsoleLog()">
                        <i class="fas fa-terminal"></i> æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
                    </button>
                </div>
            </div>
        </div>
        
        <!-- çŠ¶æ€ç›‘æ§ -->
        <div class="test-card">
            <h4>å®æ—¶çŠ¶æ€ç›‘æ§</h4>
            <div id="statusMonitor">
                <p><strong>ç¿»è½¬å‡½æ•°å­˜åœ¨:</strong> <span id="functionStatus">æ£€æŸ¥ä¸­...</span></p>
                <p><strong>å®¹å™¨çŠ¶æ€:</strong> <span id="containerStatus">æ£€æŸ¥ä¸­...</span></p>
                <p><strong>ç¿»è½¬çŠ¶æ€:</strong> <span id="flipStatus">æ£€æŸ¥ä¸­...</span></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ç¿»è½¬å†·å´æ§åˆ¶
        const flipCooldown = new Map();
        
        // ç¿»è½¬å‡½æ•°å®ç°
        function toggleTaskCardFlip(taskId) {
            console.log(`ğŸ”„ è°ƒç”¨ toggleTaskCardFlip(${taskId})`);
            
            // é˜²æŠ–æ§åˆ¶
            const now = Date.now();
            const lastFlip = flipCooldown.get(taskId) || 0;
            if (now - lastFlip < 300) {
                console.log(`ä»»åŠ¡ ${taskId} ç¿»è½¬å†·å´ä¸­ï¼Œå¿½ç•¥æ­¤æ¬¡ç‚¹å‡»`);
                addResult(`ä»»åŠ¡ ${taskId} ç¿»è½¬å†·å´ä¸­`, 'warning');
                return;
            }
            flipCooldown.set(taskId, now);
            
            // æŸ¥æ‰¾ç¿»è½¬å®¹å™¨
            let flipContainer = document.querySelector(`.task-flip-container[data-task-id="${taskId}"]`);
            if (!flipContainer) {
                const frontElement = document.querySelector(`#task-${taskId}-front`);
                if (frontElement) {
                    flipContainer = frontElement.closest('.task-flip-container');
                }
            }
            
            if (!flipContainer) {
                console.error(`æœªæ‰¾åˆ°ä»»åŠ¡IDä¸º ${taskId} çš„ç¿»è½¬å®¹å™¨`);
                addResult(`âŒ æœªæ‰¾åˆ°ä»»åŠ¡IDä¸º ${taskId} çš„ç¿»è½¬å®¹å™¨`, 'error');
                return;
            }
            
            // æ‰§è¡Œç¿»è½¬
            const wasFlipped = flipContainer.classList.contains('flipped');
            flipContainer.classList.toggle('flipped');
            const isNowFlipped = flipContainer.classList.contains('flipped');
            
            console.log(`ç¿»è½¬çŠ¶æ€å˜åŒ–: ${wasFlipped} -> ${isNowFlipped}`);
            addResult(`âœ… ä»»åŠ¡ ${taskId} ç¿»è½¬æˆåŠŸ: ${wasFlipped ? 'æ­£é¢' : 'èƒŒé¢'} -> ${isNowFlipped ? 'èƒŒé¢' : 'æ­£é¢'}`, 'success');
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
            
            // æ¸…ç†è¿‡æœŸçš„å†·å´æ—¶é—´è®°å½•
            const fiveSecondsAgo = Date.now() - 5000;
            for (const [id, timestamp] of flipCooldown.entries()) {
                if (timestamp < fiveSecondsAgo) {
                    flipCooldown.delete(id);
                }
            }
        }
        
        // æ·»åŠ è¯Šæ–­ç»“æœ
        function addResult(message, type = 'info') {
            const container = document.getElementById('resultsContainer');
            const resultDiv = document.createElement('div');
            resultDiv.className = `diagnosis-result ${type}`;
            resultDiv.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatusDisplay() {
            // æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
            const functionExists = typeof window.toggleTaskCardFlip === 'function';
            document.getElementById('functionStatus').textContent = functionExists ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨';
            document.getElementById('functionStatus').className = functionExists ? 'text-success' : 'text-danger';
            
            // æ£€æŸ¥å®¹å™¨çŠ¶æ€
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (container) {
                document.getElementById('containerStatus').textContent = 'âœ… å­˜åœ¨';
                document.getElementById('containerStatus').className = 'text-success';
                
                // æ£€æŸ¥ç¿»è½¬çŠ¶æ€
                const isFlipped = container.classList.contains('flipped');
                document.getElementById('flipStatus').textContent = isFlipped ? 'èƒŒé¢' : 'æ­£é¢';
                document.getElementById('flipStatus').className = isFlipped ? 'text-warning' : 'text-primary';
            } else {
                document.getElementById('containerStatus').textContent = 'âŒ ä¸å­˜åœ¨';
                document.getElementById('containerStatus').className = 'text-danger';
                document.getElementById('flipStatus').textContent = 'æœªçŸ¥';
                document.getElementById('flipStatus').className = 'text-muted';
            }
        }
        
        // è¿è¡Œå®Œæ•´è¯Šæ–­
        function runFullDiagnosis() {
            console.log('ğŸš€ å¼€å§‹å®Œæ•´è¯Šæ–­...');
            addResult('ğŸ” å¼€å§‹å®Œæ•´è¯Šæ–­...', 'info');
            
            // è¯Šæ–­1: å‡½æ•°å­˜åœ¨æ€§
            const functionExists = typeof window.toggleTaskCardFlip === 'function';
            if (functionExists) {
                addResult('âœ… toggleTaskCardFlip å‡½æ•°å­˜åœ¨', 'success');
                console.log('å‡½æ•°æºç :', window.toggleTaskCardFlip.toString());
            } else {
                addResult('âŒ toggleTaskCardFlip å‡½æ•°ä¸å­˜åœ¨', 'error');
                return;
            }
            
            // è¯Šæ–­2: å…ƒç´ ç»“æ„
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            const front = document.querySelector('#task-96-front');
            
            if (container) {
                addResult('âœ… ç¿»è½¬å®¹å™¨å­˜åœ¨', 'success');
                console.log('å®¹å™¨ç±»å:', container.className);
                console.log('å®¹å™¨dataset:', container.dataset);
            } else {
                addResult('âŒ ç¿»è½¬å®¹å™¨ä¸å­˜åœ¨', 'error');
            }
            
            if (front) {
                addResult('âœ… æ­£é¢å…ƒç´ å­˜åœ¨', 'success');
                console.log('æ­£é¢å…ƒç´ ID:', front.id);
                console.log('æ­£é¢å…ƒç´ çˆ¶å…ƒç´ :', front.parentElement?.className);
            } else {
                addResult('âŒ æ­£é¢å…ƒç´ ä¸å­˜åœ¨', 'error');
            }
            
            // è¯Šæ–­3: CSSæ ·å¼
            if (container) {
                const style = window.getComputedStyle(container);
                console.log('å®¹å™¨æ ·å¼ - perspective:', style.perspective);
                console.log('å®¹å™¨æ ·å¼ - transform-style:', style.transformStyle);
                console.log('å®¹å™¨æ ·å¼ - transition:', style.transition);
                addResult(`ğŸ“Š å®¹å™¨æ ·å¼æ£€æŸ¥å®Œæˆ`, 'info');
            }
            
            // è¯Šæ–­4: åŠŸèƒ½æµ‹è¯•
            testFlipFunction();
        }
        
        // æµ‹è¯•ç¿»è½¬åŠŸèƒ½
        function testFlipFunction() {
            console.log('ğŸ§ª å¼€å§‹ç¿»è½¬åŠŸèƒ½æµ‹è¯•...');
            addResult('ğŸ§ª å¼€å§‹ç¿»è½¬åŠŸèƒ½æµ‹è¯•...', 'info');
            
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (!container) {
                addResult('âŒ æ— æ³•æµ‹è¯• - å®¹å™¨ä¸å­˜åœ¨', 'error');
                return;
            }
            
            const initialState = container.classList.contains('flipped');
            addResult(`åˆå§‹çŠ¶æ€: ${initialState ? 'èƒŒé¢' : 'æ­£é¢'}`, 'info');
            
            // æ‰§è¡Œç¿»è½¬
            try {
                toggleTaskCardFlip('96');
                
                setTimeout(() => {
                    const newState = container.classList.contains('flipped');
                    if (initialState !== newState) {
                        addResult('âœ… ç¿»è½¬åŠŸèƒ½æ­£å¸¸å·¥ä½œ', 'success');
                    } else {
                        addResult('âŒ ç¿»è½¬çŠ¶æ€æœªæ”¹å˜', 'error');
                    }
                }, 500);
                
            } catch (error) {
                addResult(`âŒ ç¿»è½¬æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
                console.error('ç¿»è½¬æµ‹è¯•é”™è¯¯:', error);
            }
        }
        
        // é‡ç½®æµ‹è¯•
        function resetTest() {
            console.log('ğŸ”„ é‡ç½®æµ‹è¯•...');
            addResult('ğŸ”„ é‡ç½®æµ‹è¯•...', 'info');
            
            const container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (container) {
                container.classList.remove('flipped');
                addResult('âœ… æµ‹è¯•çŠ¶æ€å·²é‡ç½®', 'success');
            }
            
            // æ¸…ç©ºç»“æœ
            document.getElementById('resultsContainer').innerHTML = '';
            
            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay();
        }
        
        // æ˜¾ç¤ºæ§åˆ¶å°æ—¥å¿—
        function showConsoleLog() {
            addResult('ğŸ“‹ è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—', 'info');
            console.log('=== è¯Šæ–­æ—¥å¿— ===');
            console.log('ç¿»è½¬å‡½æ•°:', typeof window.toggleTaskCardFlip);
            console.log('å®¹å™¨å…ƒç´ :', document.querySelector('.task-flip-container[data-task-id="96"]'));
            console.log('æ­£é¢å…ƒç´ :', document.querySelector('#task-96-front'));
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–è¯Šæ–­å·¥å…·...');
            addResult('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ', 'info');
            updateStatusDisplay();
            
            // å®šæœŸæ›´æ–°çŠ¶æ€
            setInterval(updateStatusDisplay, 1000);
        });
    </script>
</body>
</html>