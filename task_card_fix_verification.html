<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡å¡ç‰‡ä¿®å¤éªŒè¯é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            padding: 20px;
            background-color: #f5f7fb;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .task-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .task-flip-container {
            position: relative;
            width: 100%;
            height: 250px;
            perspective: 1500px;
            transform-style: preserve-3d;
            transition: transform 0.6s ease-in-out;
        }
        .task-front, .task-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
        }
        .task-front {
            background-color: white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            z-index: 2;
        }
        .task-back {
            background-color: #f8f9fa;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            transform: rotateY(180deg);
            z-index: 1;
        }
        .task-flip-container.flipped {
            transform: rotateY(180deg);
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .btn-test {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ğŸ“‹ ä»»åŠ¡å¡ç‰‡å°ºå¯¸å’Œç¿»è½¬åŠŸèƒ½ä¿®å¤éªŒè¯</h1>
        
        <!-- æµ‹è¯•è¯´æ˜ -->
        <div class="test-section">
            <h3>ğŸ¯ æµ‹è¯•ç›®æ ‡</h3>
            <ul>
                <li>éªŒè¯ä»»åŠ¡å¡ç‰‡å°ºå¯¸ç»Ÿä¸€æ€§</li>
                <li>æµ‹è¯•ç¿»è½¬åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
                <li>ç¡®è®¤å“åº”å¼å¸ƒå±€æ­£ç¡®</li>
                <li>æ£€æŸ¥ä¸åŒçŠ¶æ€ä¸‹ï¼ˆå·²å‘è´§/æœªå‘è´§ï¼‰çš„è¡Œä¸º</li>
            </ul>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ›ï¸ æ§åˆ¶é¢æ¿</h3>
            <button class="btn btn-primary btn-test" onclick="testAllFlip()">ğŸ”„ æµ‹è¯•å…¨éƒ¨ç¿»è½¬</button>
            <button class="btn btn-success btn-test" onclick="resetAllCards()">â†©ï¸ é‡ç½®æ‰€æœ‰å¡ç‰‡</button>
            <button class="btn btn-info btn-test" onclick="toggleDebug()">ğŸ” åˆ‡æ¢è°ƒè¯•æ¨¡å¼</button>
            <button class="btn btn-warning btn-test" onclick="simulateShipped()">ğŸ“¦ æ¨¡æ‹Ÿå·²å‘è´§çŠ¶æ€</button>
        </div>

        <!-- ä»»åŠ¡å¡ç‰‡å±•ç¤ºåŒº -->
        <div class="test-section">
            <h3>ğŸ“± ä»»åŠ¡å¡ç‰‡å±•ç¤º</h3>
            <div class="task-gallery" id="testGallery">
                <!-- ä»»åŠ¡å¡ç‰‡ 1 - æ­£å¸¸çŠ¶æ€ -->
                <div class="task-flip-container" data-task-id="test-001">
                    <div class="task-front">
                        <span class="status-badge bg-primary text-white">å¾…å¤„ç†</span>
                        <div class="text-center">
                            <div class="mb-3">
                                <i class="fas fa-box fa-3x text-muted"></i>
                            </div>
                            <h5>åŒ–å¦†å“åŒ…</h5>
                            <p class="text-muted">è´§å·: KABI-165</p>
                            <p class="text-muted">æ•°é‡: 1</p>
                            <p class="text-muted small">åˆ›å»ºäºº: ç®¡ç†å‘˜</p>
                        </div>
                        <button class="btn btn-outline-primary btn-sm" data-action="flip" data-task-id="test-001">
                            <i class="fas fa-info-circle me-1"></i>æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                    <div class="task-back">
                        <h5>ğŸ“¦ è¯¦ç»†ä¿¡æ¯</h5>
                        <div class="text-start">
                            <p><strong>å•†å“åç§°:</strong> åŒ–å¦†å“åŒ…</p>
                            <p><strong>è´§å·:</strong> KABI-165</p>
                            <p><strong>æ•°é‡:</strong> 1</p>
                            <p><strong>åˆ›å»ºæ—¶é—´:</strong> 2024-01-15</p>
                            <p><strong>å¤‡æ³¨:</strong> æ ‡å‡†åŒ…è£…</p>
                        </div>
                        <div class="mt-auto">
                            <button class="btn btn-success btn-sm w-100 mb-2" data-action="complete-shipment" data-task-id="test-001">
                                <i class="fas fa-truck me-1"></i>ç¡®è®¤å‘è´§
                            </button>
                            <button class="btn btn-outline-secondary btn-sm w-100" data-action="flip" data-task-id="test-001">
                                <i class="fas fa-arrow-left me-1"></i>è¿”å›
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ä»»åŠ¡å¡ç‰‡ 2 - å·²å‘è´§çŠ¶æ€ -->
                <div class="task-flip-container" data-task-id="test-002">
                    <div class="task-front">
                        <span class="status-badge bg-success text-white">å·²å‘è´§</span>
                        <div class="text-center">
                            <div class="mb-3">
                                <i class="fas fa-box-open fa-3x text-success"></i>
                            </div>
                            <h5>ç”µå­äº§å“å¥—è£…</h5>
                            <p class="text-muted">è´§å·: TECH-001</p>
                            <p class="text-muted">æ•°é‡: 3</p>
                            <p class="text-muted small">åˆ›å»ºäºº: é”€å”®A</p>
                        </div>
                        <button class="btn btn-outline-primary btn-sm" data-action="flip" data-task-id="test-002" disabled>
                            <i class="fas fa-info-circle me-1"></i>æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                    <div class="task-back">
                        <h5>ğŸ“¦ å·²å‘è´§è¯¦æƒ…</h5>
                        <div class="text-start">
                            <p><strong>å•†å“åç§°:</strong> ç”µå­äº§å“å¥—è£…</p>
                            <p><strong>è´§å·:</strong> TECH-001</p>
                            <p><strong>æ•°é‡:</strong> 3</p>
                            <p><strong>å‘è´§æ—¶é—´:</strong> 2024-01-15 14:30</p>
                            <p><strong>ç‰©æµå•å·:</strong> SF123456789CN</p>
                        </div>
                        <div class="mt-auto">
                            <button class="btn btn-secondary btn-sm w-100" disabled>
                                <i class="fas fa-check me-1"></i>å·²å®Œæˆå‘è´§
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ä»»åŠ¡å¡ç‰‡ 3 - æµ‹è¯•ç¿»è½¬ -->
                <div class="task-flip-container" data-task-id="test-003">
                    <div class="task-front">
                        <span class="status-badge bg-warning text-dark">å¤„ç†ä¸­</span>
                        <div class="text-center">
                            <div class="mb-3">
                                <i class="fas fa-cogs fa-3x text-warning"></i>
                            </div>
                            <h5>å®¶å±…ç”¨å“ç»„åˆ</h5>
                            <p class="text-muted">è´§å·: HOME-007</p>
                            <p class="text-muted">æ•°é‡: 2</p>
                            <p class="text-muted small">åˆ›å»ºäºº: é”€å”®B</p>
                        </div>
                        <button class="btn btn-outline-primary btn-sm" data-action="flip" data-task-id="test-003">
                            <i class="fas fa-info-circle me-1"></i>æŸ¥çœ‹è¯¦æƒ…
                        </button>
                    </div>
                    <div class="task-back">
                        <h5>ğŸ”§ å¤„ç†ä¸­ä¿¡æ¯</h5>
                        <div class="text-start">
                            <p><strong>å•†å“åç§°:</strong> å®¶å±…ç”¨å“ç»„åˆ</p>
                            <p><strong>è´§å·:</strong> HOME-007</p>
                            <p><strong>æ•°é‡:</strong> 2</p>
                            <p><strong>å¤„ç†è¿›åº¦:</strong> åŒ…è£…å®Œæˆ 80%</p>
                            <p><strong>é¢„è®¡å®Œæˆ:</strong> 2024-01-16</p>
                        </div>
                        <div class="mt-auto">
                            <button class="btn btn-success btn-sm w-100 mb-2" data-action="complete-shipment" data-task-id="test-003">
                                <i class="fas fa-truck me-1"></i>ç¡®è®¤å‘è´§
                            </button>
                            <button class="btn btn-outline-secondary btn-sm w-100" data-action="flip" data-task-id="test-003">
                                <i class="fas fa-arrow-left me-1"></i>è¿”å›
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>
    </div>

    <script src="task_card_dimension_flip_fix.js"></script>
    <script>
        let debugMode = false;
        let testResults = [];

        // æµ‹è¯•æ‰€æœ‰ç¿»è½¬åŠŸèƒ½
        function testAllFlip() {
            const containers = document.querySelectorAll('.task-flip-container');
            let successCount = 0;
            
            containers.forEach((container, index) => {
                setTimeout(() => {
                    const taskId = container.getAttribute('data-task-id');
                    if (typeof window.toggleTaskCardFlip === 'function') {
                        window.toggleTaskCardFlip(taskId);
                        successCount++;
                    }
                }, index * 500);
            });
            
            setTimeout(() => {
                addTestResult(`ğŸ”„ ç¿»è½¬æµ‹è¯•: æˆåŠŸè§¦å‘ ${successCount} ä¸ªä»»åŠ¡å¡ç‰‡ç¿»è½¬`, 'success');
            }, containers.length * 500 + 1000);
        }

        // é‡ç½®æ‰€æœ‰å¡ç‰‡
        function resetAllCards() {
            document.querySelectorAll('.task-flip-container.flipped').forEach(container => {
                container.classList.remove('flipped');
                const flipButton = container.querySelector('[data-action="flip"]');
                if (flipButton) {
                    flipButton.innerHTML = '<i class="fas fa-info-circle me-1"></i>æŸ¥çœ‹è¯¦æƒ…';
                }
            });
            addTestResult('â†©ï¸ å·²é‡ç½®æ‰€æœ‰å¡ç‰‡åˆ°åˆå§‹çŠ¶æ€', 'info');
        }

        // åˆ‡æ¢è°ƒè¯•æ¨¡å¼
        function toggleDebug() {
            debugMode = !debugMode;
            const debugStyleId = 'task-card-debug-style';
            let debugStyle = document.getElementById(debugStyleId);
            
            if (debugMode) {
                if (!debugStyle) {
                    debugStyle = document.createElement('style');
                    debugStyle.id = debugStyleId;
                    debugStyle.textContent = `
                        .task-flip-container { outline: 2px solid #007bff !important; }
                        .task-front { outline: 2px solid #28a745 !important; }
                        .task-back { outline: 2px solid #dc3545 !important; }
                    `;
                    document.head.appendChild(debugStyle);
                }
                addTestResult('ğŸ” è°ƒè¯•æ¨¡å¼å·²å¼€å¯ - æ˜¾ç¤ºè¾¹ç•Œçº¿', 'warning');
            } else {
                if (debugStyle) {
                    debugStyle.remove();
                }
                addTestResult('ğŸ” è°ƒè¯•æ¨¡å¼å·²å…³é—­', 'info');
            }
        }

        // æ¨¡æ‹Ÿå·²å‘è´§çŠ¶æ€
        function simulateShipped() {
            const containers = document.querySelectorAll('.task-flip-container');
            containers[0].querySelector('.status-badge').className = 'status-badge bg-success text-white';
            containers[0].querySelector('.status-badge').textContent = 'å·²å‘è´§';
            containers[0].querySelector('[data-action="flip"]').disabled = true;
            addTestResult('ğŸ“¦ å·²æ¨¡æ‹Ÿç¬¬ä¸€ä¸ªä»»åŠ¡ä¸ºå·²å‘è´§çŠ¶æ€', 'success');
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultItem = document.createElement('div');
            resultItem.className = `alert alert-${type} mb-2`;
            resultItem.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
            resultsDiv.appendChild(resultItem);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            // é™åˆ¶ç»“æœæ˜¾ç¤ºæ•°é‡
            if (resultsDiv.children.length > 10) {
                resultsDiv.removeChild(resultsDiv.firstChild);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestResult('âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œä¿®å¤è„šæœ¬å·²æ¿€æ´»', 'success');
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-action="flip"]')) {
                    e.preventDefault();
                    const taskId = e.target.closest('[data-action="flip"]').getAttribute('data-task-id');
                    addTestResult(`ğŸ–±ï¸ ç”¨æˆ·ç‚¹å‡»ç¿»è½¬æŒ‰é’® - ä»»åŠ¡: ${taskId}`, 'info');
                }
                
                if (e.target.closest('[data-action="complete-shipment"]')) {
                    e.preventDefault();
                    const taskId = e.target.closest('[data-action="complete-shipment"]').getAttribute('data-task-id');
                    addTestResult(`ğŸšš ç”¨æˆ·ç‚¹å‡»å‘è´§ç¡®è®¤ - ä»»åŠ¡: ${taskId}`, 'warning');
                }
            });
        });

        // ç›‘å¬ç¿»è½¬äº‹ä»¶
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const target = mutation.target;
                    if (target.classList.contains('task-flip-container')) {
                        const taskId = target.getAttribute('data-task-id');
                        const isFlipped = target.classList.contains('flipped');
                        addTestResult(`ğŸ”„ ä»»åŠ¡ ${taskId} ${isFlipped ? 'ç¿»è½¬åˆ°èƒŒé¢' : 'å¤ä½åˆ°æ­£é¢'}`, 'info');
                    }
                }
            });
        });

        // å¼€å§‹è§‚å¯Ÿ
        document.querySelectorAll('.task-flip-container').forEach(container => {
            observer.observe(container, { attributes: true, attributeFilter: ['class'] });
        });
    </script>
</body>
</html>