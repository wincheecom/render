<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®è¿è¥ä»»åŠ¡å¡ç¿»è½¬ä¿®å¤æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f5f7fb;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .result-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .test-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
        }
        .task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">
            <i class="fas fa-tools me-2"></i>
            é”€å”®è¿è¥ä»»åŠ¡å¡ç¿»è½¬ä¿®å¤æµ‹è¯•
        </h1>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="result-panel">
            <h3><i class="fas fa-gamepad me-2"></i>æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-primary w-100 mb-2" onclick="runFullDiagnostic()">
                        <i class="fas fa-stethoscope me-2"></i>è¿è¡Œå®Œæ•´è¯Šæ–­
                    </button>
                    <button class="btn btn-success w-100 mb-2" onclick="executeFix()">
                        <i class="fas fa-wrench me-2"></i>æ‰§è¡Œä¿®å¤ç¨‹åº
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-info w-100 mb-2" onclick="testFlipFunction()">
                        <i class="fas fa-sync-alt me-2"></i>æµ‹è¯•ç¿»è½¬åŠŸèƒ½
                    </button>
                    <button class="btn btn-warning w-100 mb-2" onclick="resetTest()">
                        <i class="fas fa-redo me-2"></i>é‡ç½®æµ‹è¯•ç¯å¢ƒ
                    </button>
                </div>
            </div>
        </div>
        
        <!-- è¯Šæ–­ç»“æœé¢æ¿ -->
        <div class="result-panel">
            <h3><i class="fas fa-clipboard-check me-2"></i>å®æ—¶è¯Šæ–­ç»“æœ</h3>
            <div id="diagnostic-results">
                <p class="text-muted">ç‚¹å‡»"è¿è¡Œå®Œæ•´è¯Šæ–­"å¼€å§‹æ£€æŸ¥...</p>
            </div>
        </div>
        
        <!-- æµ‹è¯•ä»»åŠ¡å¡ç‰‡ -->
        <div class="test-card">
            <h3><i class="fas fa-tasks me-2"></i>æµ‹è¯•ä»»åŠ¡å¡ç‰‡</h3>
            <p>ä»¥ä¸‹æ˜¯æ¨¡æ‹Ÿçš„é”€å”®è¿è¥ä»»åŠ¡å¡ç‰‡ï¼Œç”¨äºæµ‹è¯•ç¿»è½¬åŠŸèƒ½ï¼š</p>
            
            <div class="task-grid">
                <!-- ä»»åŠ¡å¡ç‰‡ 96 (é—®é¢˜å¡ç‰‡) -->
                <div class="task-flip-container" data-task-id="96" id="test-container-96">
                    <div class="task-front" id="task-96-front" data-task-id="96" 
                         style="position: relative !important; width: 100% !important; max-width: 282.66px !important; height: auto !important; min-height: 307.46px !important; margin: 0px !important; padding: 10px !important; box-sizing: border-box !important; z-index: 1 !important;">
                        <div class="task-gallery-img" style="width: 262.66px !important; height: 259.06px !important; object-fit: cover !important; border-radius: 6px !important; margin-bottom: 8px !important; background-color: rgb(248, 249, 250) !important; display: flex !important; align-items: center !important; justify-content: center !important; min-height: 259.06px !important; max-height: 259.06px !important;">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-image fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions d-flex align-items-center gap-2 flex-shrink-0">
                                <span class="badge badge-warning" style="padding: 2px 6px; font-size: 0.7rem; min-width: 40px; text-align: center;">
                                    å¾…å‘
                                </span>
                            </div>
                            <div class="task-info-inline d-flex align-items-center gap-2 flex-shrink-0 ms-auto">
                                <div class="task-gallery-name" style="font-size: 0.85rem; font-weight: 600; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 120px;">ç«‹ä½“æ‹¼å›¾äº¤é€š</div>
                                <div class="task-gallery-qty" data-content="1" style="font-size: 0.75rem; color: #888; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100px;">æ•°é‡: 1</div>
                                <div class="task-gallery-creator" data-content="ç®¡ç†å‘˜" style="font-size: 0.7rem; color: #999; margin-bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px;">åˆ›å»ºäºº: ç®¡ç†å‘˜</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back" data-task-id="96">
                        <div class="task-back-content">
                            <h5>ä»»åŠ¡è¯¦æƒ…</h5>
                            <div class="task-files-preview">
                                <div class="file-item">
                                    <i class="fas fa-barcode"></i>
                                    <span>æœ¬ä½“ç </span>
                                </div>
                                <div class="file-item">
                                    <i class="fas fa-qrcode"></i>
                                    <span>æ¡ç </span>
                                </div>
                                <div class="file-item">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>è­¦ç¤ºç </span>
                                </div>
                                <div class="file-item">
                                    <i class="fas fa-box"></i>
                                    <span>ç®±å”›</span>
                                </div>
                                <div class="file-item">
                                    <i class="fas fa-book"></i>
                                    <span>è¯´æ˜ä¹¦</span>
                                </div>
                            </div>
                            <div class="task-back-actions">
                                <button class="btn btn-outline-secondary btn-sm" onclick="toggleTaskCardFlip('96')">
                                    <i class="fas fa-arrow-left me-1"></i>è¿”å›
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="completeShipment('96')">
                                    <i class="fas fa-truck me-1"></i>ç¡®è®¤å‘è´§
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ­£å¸¸ä»»åŠ¡å¡ç‰‡å¯¹æ¯” -->
                <div class="task-flip-container" data-task-id="97">
                    <div class="task-front" data-task-id="97">
                        <div class="task-gallery-img">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-image fa-2x text-muted"></i>
                            </div>
                        </div>
                        <div class="task-card-content d-flex align-items-center gap-2 w-100">
                            <div class="task-gallery-actions">
                                <span class="badge bg-warning">å¾…å‘</span>
                            </div>
                            <div class="task-info-inline ms-auto">
                                <div class="task-gallery-name">æ­£å¸¸ä»»åŠ¡å¡ç‰‡</div>
                                <div class="task-gallery-qty">æ•°é‡: 2</div>
                            </div>
                        </div>
                    </div>
                    <div class="task-back" data-task-id="97">
                        <h5>æ­£å¸¸å¡ç‰‡èƒŒé¢</h5>
                        <p>è¿™æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ä»»åŠ¡å¡ç‰‡èƒŒé¢</p>
                        <button class="btn btn-outline-secondary" onclick="toggleTaskCardFlip('97')">
                            <i class="fas fa-arrow-left"></i> è¿”å›
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="result-panel">
            <h3><i class="fas fa-terminal me-2"></i>æµ‹è¯•æ—¥å¿—</h3>
            <div id="test-log" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; height: 300px; overflow-y: auto;">
                <p class="text-muted">æµ‹è¯•æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="sales_task_flip_fix.js"></script>
    <script>
        // æµ‹è¯•å·¥å…·å‡½æ•°
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = {
                'success': 'text-success',
                'error': 'text-danger',
                'warning': 'text-warning',
                'info': 'text-info'
            }[type] || 'text-dark';
            
            logDiv.innerHTML += `<div class="${typeClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function addDiagnosticResult(title, status, message) {
            const resultsDiv = document.getElementById('diagnostic-results');
            const statusClass = {
                'success': 'status-success',
                'error': 'status-error',
                'warning': 'status-warning',
                'info': 'status-info'
            }[status];
            
            resultsDiv.innerHTML += `
                <div class="mb-2">
                    <span class="status-indicator ${statusClass}"></span>
                    <strong>${title}:</strong> ${message}
                </div>
            `;
        }
        
        // è¯Šæ–­å‡½æ•°
        function runFullDiagnostic() {
            addLog('å¼€å§‹è¿è¡Œå®Œæ•´è¯Šæ–­...', 'info');
            const resultsDiv = document.getElementById('diagnostic-results');
            resultsDiv.innerHTML = '<p class="text-muted">æ­£åœ¨è¯Šæ–­ä¸­...</p>';
            
            setTimeout(() => {
                resultsDiv.innerHTML = '';
                
                // æ£€æŸ¥å…ƒç´ å­˜åœ¨æ€§
                const task96Container = document.querySelector('.task-flip-container[data-task-id="96"]');
                const task96Front = document.querySelector('#task-96-front.task-front');
                const task96Back = document.querySelector('.task-back[data-task-id="96"]');
                const flipFunction = typeof window.toggleTaskCardFlip === 'function';
                const fixStyles = document.getElementById('sales-task-flip-fix-styles');
                
                // æ˜¾ç¤ºè¯Šæ–­ç»“æœ
                addDiagnosticResult(
                    'ä»»åŠ¡96ç¿»è½¬å®¹å™¨',
                    task96Container ? 'success' : 'error',
                    task96Container ? 'å­˜åœ¨' : 'ç¼ºå¤±'
                );
                
                addDiagnosticResult(
                    'ä»»åŠ¡96æ­£é¢å…ƒç´ ',
                    task96Front ? 'success' : 'error',
                    task96Front ? 'å­˜åœ¨' : 'ç¼ºå¤±'
                );
                
                addDiagnosticResult(
                    'ä»»åŠ¡96èƒŒé¢å…ƒç´ ',
                    task96Back ? 'success' : 'warning',
                    task96Back ? 'å­˜åœ¨' : 'ç¼ºå¤±ï¼ˆå°†è‡ªåŠ¨åˆ›å»ºï¼‰'
                );
                
                addDiagnosticResult(
                    'ç¿»è½¬å‡½æ•°',
                    flipFunction ? 'success' : 'error',
                    flipFunction ? 'å¯ç”¨' : 'ä¸å¯ç”¨'
                );
                
                addDiagnosticResult(
                    'ä¿®å¤æ ·å¼è¡¨',
                    fixStyles ? 'success' : 'info',
                    fixStyles ? 'å·²åŠ è½½' : 'æœªåŠ è½½ï¼ˆæ‰§è¡Œä¿®å¤åå°†æ·»åŠ ï¼‰'
                );
                
                // åˆ†æé—®é¢˜ä¸¥é‡ç¨‹åº¦
                const issues = [];
                if (!task96Container) issues.push('ç¼ºå°‘ç¿»è½¬å®¹å™¨');
                if (!task96Front) issues.push('ç¼ºå°‘æ­£é¢å…ƒç´ ');
                if (!flipFunction) issues.push('ç¿»è½¬å‡½æ•°ç¼ºå¤±');
                
                if (issues.length === 0) {
                    addDiagnosticResult('æ€»ä½“è¯„ä¼°', 'success', 'âœ… ç³»ç»ŸçŠ¶æ€è‰¯å¥½ï¼Œç¿»è½¬åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ');
                } else {
                    addDiagnosticResult('æ€»ä½“è¯„ä¼°', 'warning', `âš ï¸ å‘ç° ${issues.length} ä¸ªé—®é¢˜: ${issues.join(', ')}`);
                }
                
                addLog(`è¯Šæ–­å®Œæˆï¼Œå‘ç°é—®é¢˜: ${issues.length} ä¸ª`, issues.length === 0 ? 'success' : 'warning');
            }, 1000);
        }
        
        // æ‰§è¡Œä¿®å¤
        function executeFix() {
            addLog('å¼€å§‹æ‰§è¡Œä¿®å¤ç¨‹åº...', 'info');
            
            if (typeof window.executeSalesTaskFlipFix === 'function') {
                window.executeSalesTaskFlipFix();
                addLog('ä¿®å¤ç¨‹åºæ‰§è¡Œå®Œæˆ', 'success');
                
                // é‡æ–°è¿è¡Œè¯Šæ–­
                setTimeout(runFullDiagnostic, 2000);
            } else {
                addLog('é”™è¯¯ï¼šä¿®å¤å‡½æ•°ä¸å¯ç”¨', 'error');
            }
        }
        
        // æµ‹è¯•ç¿»è½¬åŠŸèƒ½
        function testFlipFunction() {
            addLog('å¼€å§‹æµ‹è¯•ç¿»è½¬åŠŸèƒ½...', 'info');
            
            const task96Container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (!task96Container) {
                addLog('é”™è¯¯ï¼šæœªæ‰¾åˆ°ä»»åŠ¡96å®¹å™¨', 'error');
                return;
            }
            
            // æµ‹è¯•ç¿»è½¬
            if (typeof window.toggleTaskCardFlip === 'function') {
                addLog('æ‰§è¡Œç¿»è½¬åˆ°èƒŒé¢...', 'info');
                window.toggleTaskCardFlip('96');
                
                setTimeout(() => {
                    const isFlipped = task96Container.classList.contains('flipped');
                    if (isFlipped) {
                        addLog('âœ… ç¿»è½¬åˆ°èƒŒé¢æˆåŠŸ', 'success');
                        
                        // æµ‹è¯•ç¿»è½¬å›æ¥
                        setTimeout(() => {
                            addLog('æ‰§è¡Œç¿»è½¬å›æ­£é¢...', 'info');
                            window.toggleTaskCardFlip('96');
                            
                            setTimeout(() => {
                                const isBack = task96Container.classList.contains('flipped');
                                if (!isBack) {
                                    addLog('âœ… ç¿»è½¬å›æ­£é¢æˆåŠŸ', 'success');
                                    addLog('ğŸ‰ å®Œæ•´ç¿»è½¬æµ‹è¯•é€šè¿‡ï¼', 'success');
                                } else {
                                    addLog('âŒ ç¿»è½¬å›æ­£é¢å¤±è´¥', 'error');
                                }
                            }, 600);
                        }, 1000);
                    } else {
                        addLog('âŒ ç¿»è½¬åˆ°èƒŒé¢å¤±è´¥', 'error');
                    }
                }, 600);
            } else {
                addLog('é”™è¯¯ï¼šç¿»è½¬å‡½æ•°ä¸å¯ç”¨', 'error');
            }
        }
        
        // é‡ç½®æµ‹è¯•ç¯å¢ƒ
        function resetTest() {
            addLog('é‡ç½®æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // ç§»é™¤ä¿®å¤æ ·å¼
            const fixStyles = document.getElementById('sales-task-flip-fix-styles');
            if (fixStyles) {
                fixStyles.remove();
                addLog('å·²ç§»é™¤ä¿®å¤æ ·å¼', 'info');
            }
            
            // é‡ç½®ç¿»è½¬çŠ¶æ€
            const task96Container = document.querySelector('.task-flip-container[data-task-id="96"]');
            if (task96Container) {
                task96Container.classList.remove('flipped');
                addLog('å·²é‡ç½®ç¿»è½¬çŠ¶æ€', 'info');
            }
            
            // æ¸…ç©ºè¯Šæ–­ç»“æœ
            document.getElementById('diagnostic-results').innerHTML = '<p class="text-muted">ç‚¹å‡»"è¿è¡Œå®Œæ•´è¯Šæ–­"å¼€å§‹æ£€æŸ¥...</p>';
            
            addLog('æµ‹è¯•ç¯å¢ƒé‡ç½®å®Œæˆ', 'success');
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            addLog('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            addLog('è¯·å…ˆè¿è¡Œè¯Šæ–­ï¼Œç„¶åæ‰§è¡Œä¿®å¤ç¨‹åº', 'info');
        });
    </script>
</body>
</html>